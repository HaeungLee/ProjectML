# ğŸŒ™ ë‹¬ë¹› ë¹„ì„œ ì‹œìŠ¤í…œ - ìµœì¢… ì„¤ê³„ í™•ì •
**ì‘ì„±ì¼**: 2024-12-14
**ê¸°ë°˜**: `1124_ì„¤ê³„.md` + ë…¼ì˜ ê²°ê³¼
**ëª©ì **: ê¸¸ì„ ìƒì–´ë„ ë°©í–¥ì„ ìƒì§€ ì•Šì„ ë“±ëŒ€ ë¬¸ì„œ

---

## ğŸ¯ í•µì‹¬ ëª©í‘œ (ì ˆëŒ€ ìŠì§€ ë§ ê²ƒ)

```
1. ì§€ì—°ì‹œê°„ ìµœì†Œí™” (< 3ì´ˆ)
2. Function Calling 100% ì •í™•ë„ (Multi-agent ê²€ì¦)
3. RAG + Memory í†µí•©
4. Constitutional AIë¡œ ì² í•™ êµ¬í˜„
5. í™•ì¥ ê°€ëŠ¥í•œ Tool System
```

---

## âœ… í™•ì •ëœ ê¸°ìˆ ìŠ¤íƒ

### Layerë³„ ìŠ¤íƒ

| Layer | Technology | í™•ì • ì´ìœ  |
|-------|-----------|----------|
| **Web UI (MVP)** | React | Quick Win, ë¹ ë¥¸ ê°œë°œ |
| **Mobile (Phase 2)** | Flutter | ë„¤ì´í‹°ë¸Œ ì„±ëŠ¥ |
| **Gateway** | Rust (Actix-web, Tonic) | ì €ì§€ì—°, Zero-copy |
| **AI Core** | Python 3.11 (FastAPI, LangChain) | AI ìƒíƒœê³„ |
| **Voice Service** | Python (FastAPI) | ìŒì„± ì²˜ë¦¬ |
| **Communication** | gRPC (Protocol Buffers) | íƒ€ì… ì•ˆì „, ìŠ¤íŠ¸ë¦¬ë° |
| **Database** | PostgreSQL + pgvector (Docker) | RAG, ë²¡í„° ê²€ìƒ‰ |
| **Cache** | Redis (Docker) | Short-term memory |
| **LLM** | OpenRouter API | Tool Calling ì§€ì›, ë¬´ë£Œ ëª¨ë¸ |
| **Validation** | Pydantic | ë‹¨ìˆœ, LangChain í˜¸í™˜ |

### ë²„ë¦° ê²ƒë“¤
```
âŒ Typia (ë³µì¡ë„)
âŒ Agentica (ì œì•½ ê³¼ë‹¤)
âŒ React Native (ì‹¤íŒ¨ ê²½í—˜)
âŒ PWA (ë§ˆì´ê·¸ë ˆì´ì…˜ ë³µì¡ë„)
```

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

### Phase 1: ëª¨ë…¸ë ˆí¬ (MVP)

```
moonlight/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ gateway/              # Rust - í•µì‹¬ ë¼ìš°í„°
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ main.rs
â”‚   â”‚       â”œâ”€â”€ grpc/         # gRPC ì„œë²„
â”‚   â”‚       â””â”€â”€ streaming/    # ìŒì„± ìŠ¤íŠ¸ë¦¬ë°
â”‚   â”‚
â”‚   â”œâ”€â”€ ai-core/              # Python - AI ë‘ë‡Œ
â”‚   â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ agents/       # Multi-agent ì‹œìŠ¤í…œ
â”‚   â”‚       â”œâ”€â”€ tools/        # Tool System (Plugin)
â”‚   â”‚       â”œâ”€â”€ memory/       # RAG + 3-Layer Memory
â”‚   â”‚       â”œâ”€â”€ constitution/ # Constitutional AI
â”‚   â”‚       â””â”€â”€ llm/          # LLM Provider
â”‚   â”‚
â”‚   â”œâ”€â”€ voice-service/        # Python - STT/TTS
â”‚   â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ stt/          # Meta Omnilingual ASR
â”‚   â”‚       â””â”€â”€ tts/          # ElevenLabs + Edge-TTS
â”‚   â”‚
â”‚   â””â”€â”€ web-ui/               # React - í…ŒìŠ¤íŠ¸ UI
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ src/
â”‚
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ proto/                # gRPC ì •ì˜
â”‚   â”‚   â”œâ”€â”€ assistant.proto
â”‚   â”‚   â””â”€â”€ voice.proto
â”‚   â””â”€â”€ types/                # ê³µìœ  íƒ€ì…
â”‚
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ docker-compose.yml    # PostgreSQL, Redis
â”‚   â””â”€â”€ Dockerfile.*          # ì„œë¹„ìŠ¤ë³„ Dockerfile
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ constitution.yaml     # Constitutional AI ì •ì˜
â”‚   â”œâ”€â”€ philosophy.md         # ì² í•™ ë¬¸ì„œ
â”‚   â””â”€â”€ architecture.md       # ì•„í‚¤í…ì²˜ ë¬¸ì„œ
â”‚
â”œâ”€â”€ scripts/                  # ê°œë°œ ìŠ¤í¬ë¦½íŠ¸
â””â”€â”€ README.md
```

### Phase 2: ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ (í™•ì¥)

```
[Flutter App] â†â†’ [API Gateway]
                      â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“             â†“             â†“
   [AI Core]    [Voice Service]  [Tool Service]
        â†“             â†“             â†“
   [PostgreSQL]   [Redis]      [External APIs]
```

---

## ğŸ“¡ í•˜ì´ë¸Œë¦¬ë“œ í†µì‹  êµ¬ì¡° (í™•ì •)

### í•µì‹¬ ì›ì¹™

```
ì™¸ë¶€ í†µì‹  (ë¸Œë¼ìš°ì €/ì•± â†” ì„œë²„): REST + WebSocket
ë‚´ë¶€ í†µì‹  (ì„œë¹„ìŠ¤ â†” ì„œë¹„ìŠ¤): gRPC (ì²˜ìŒë¶€í„°!)
```

### ì™œ í•˜ì´ë¸Œë¦¬ë“œì¸ê°€?

| ë¬¸ì œ | í•´ê²°ì±… |
|------|--------|
| ì›¹ ë¸Œë¼ìš°ì €ëŠ” gRPC ì§ì ‘ í˜¸ì¶œ ë¶ˆê°€ | ì™¸ë¶€ëŠ” REST/WS ìœ ì§€ |
| RESTâ†’gRPC ë§ˆì´ê·¸ë ˆì´ì…˜ ë¹„ìš© ë†’ìŒ | ë‚´ë¶€ëŠ” ì²˜ìŒë¶€í„° gRPC |
| FlutterëŠ” gRPC ë„¤ì´í‹°ë¸Œ ì§€ì› | Phase 4ì—ì„œ ì§ì ‘ ì—°ê²° |

### Phase 1-3: MVP êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MVP Architecture                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      REST/WebSocket      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  React   â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚    AI Core       â”‚ â”‚
â”‚  â”‚  Web UI  â”‚      (FastAPI)           â”‚    (Python)      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚            â”‚
â”‚                                           gRPC  â”‚            â”‚
â”‚                                                 â†“            â”‚
â”‚                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                                        â”‚  Voice Service   â”‚ â”‚
â”‚                                        â”‚    (Python)      â”‚ â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚PostgreSQLâ”‚              â”‚  Redis   â”‚                     â”‚
â”‚  â”‚ +pgvectorâ”‚              â”‚          â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚       Docker                  Docker                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Phase 4+: Production êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Production Architecture                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      REST/WebSocket      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  React   â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚    Rust          â”‚ â”‚
â”‚  â”‚  Web UI  â”‚                          â”‚    Gateway       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           gRPC                   â”‚            â”‚
â”‚  â”‚ Flutter  â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚   App    â”‚                                  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚            â”‚
â”‚                                                 â”‚ gRPC       â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                           â†“                     â†“       â”‚   â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚                  â”‚    AI Core       â”‚  â”‚    Voice     â”‚ â”‚   â”‚
â”‚                  â”‚    (Python)      â”‚  â”‚   Service    â”‚ â”‚   â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚                           â”‚ gRPC                        â”‚   â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í†µì‹  í”„ë¡œí† ì½œ ì •ë¦¬

| êµ¬ê°„ | í”„ë¡œí† ì½œ | ì‹œì  | ì´ìœ  |
|------|---------|------|------|
| Web UI â†” AI Core | REST + WS | MVP | ë¸Œë¼ìš°ì € í˜¸í™˜ |
| AI Core â†” Voice | gRPC | **ì²˜ìŒë¶€í„°** | ìŠ¤íŠ¸ë¦¬ë°, ì„±ëŠ¥ |
| Flutter â†” Gateway | gRPC | Phase 4 | ë„¤ì´í‹°ë¸Œ ì„±ëŠ¥ |
| Gateway â†” Services | gRPC | Phase 4 | í†µí•© |

### ë§ˆì´ê·¸ë ˆì´ì…˜ ë¹„ìš© ìµœì†Œí™”

```
âœ… ë‚´ë¶€ í†µì‹ : ë§ˆì´ê·¸ë ˆì´ì…˜ ì—†ìŒ (ì²˜ìŒë¶€í„° gRPC)
âœ… ì™¸ë¶€ í†µì‹ : Gatewayê°€ REST ìœ ì§€ (ë³€ê²½ ì—†ìŒ)
âœ… Flutter: gRPC ì§ì ‘ ì—°ê²° (ìƒˆë¡œ êµ¬í˜„)
```

### proto íŒŒì¼ (ì²˜ìŒë¶€í„° ì •ì˜)

```protobuf
// shared/proto/voice.proto
syntax = "proto3";

package moonlight.voice;

service VoiceService {
  // STT: ìŒì„± â†’ í…ìŠ¤íŠ¸
  rpc Transcribe(stream AudioChunk) returns (TranscribeResponse);
  
  // TTS: í…ìŠ¤íŠ¸ â†’ ìŒì„±
  rpc Synthesize(SynthesizeRequest) returns (stream AudioChunk);
}

message AudioChunk {
  bytes data = 1;
  int32 sample_rate = 2;
}

message TranscribeResponse {
  string text = 1;
  float confidence = 2;
}

message SynthesizeRequest {
  string text = 1;
  string voice_id = 2;
}
```

```protobuf
// shared/proto/agent.proto
syntax = "proto3";

package moonlight.agent;

service AgentService {
  // ëŒ€í™” ì²˜ë¦¬
  rpc Chat(ChatRequest) returns (stream ChatResponse);
  
  // Tool ì‹¤í–‰
  rpc ExecuteTool(ToolRequest) returns (ToolResponse);
}

message ChatRequest {
  string user_id = 1;
  string message = 2;
  repeated Message history = 3;
}

message ChatResponse {
  string content = 1;
  bool is_complete = 2;
  optional ToolCall tool_call = 3;
}

message ToolCall {
  string tool_name = 1;
  string parameters = 2;  // JSON string
}
```

---

## ğŸ¤– Multi-Agent System (í•µì‹¬!)

### Arionì˜ ì¥ì  ê³„ìŠ¹: 3ë‹¨ê³„ ê²€ì¦

```
ì‚¬ìš©ì ì…ë ¥
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stage 1: Intent Parser Agent           â”‚
â”‚  - ì‚¬ìš©ì ì˜ë„ íŒŒì•…                      â”‚
â”‚  - Tool í›„ë³´ ì„ íƒ                        â”‚
â”‚  - ì •í™•ë„: ~75%                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stage 2: Parameter Validator Agent     â”‚
â”‚  - íŒŒë¼ë¯¸í„° ê²€ì¦ (Pydantic)             â”‚
â”‚  - ëˆ„ë½/ì˜¤ë¥˜ ìˆ˜ì •                        â”‚
â”‚  - ì •í™•ë„: ~99%                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stage 3: Execution Verifier Agent      â”‚
â”‚  - ì‹¤í–‰ ì „ ìµœì¢… í™•ì¸                     â”‚
â”‚  - ì‚¬ìš©ì í™•ì¸ (í•„ìš”ì‹œ)                  â”‚
â”‚  - ì •í™•ë„: 100%                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Tool ì‹¤í–‰ â†’ ê²°ê³¼ ë°˜í™˜
```

### êµ¬í˜„ êµ¬ì¡°

```python
# packages/ai-core/src/agents/orchestrator.py
from typing import Optional
from pydantic import BaseModel

class AgentOrchestrator:
    """3ë‹¨ê³„ ê²€ì¦ Multi-Agent ì‹œìŠ¤í…œ"""
    
    def __init__(self):
        self.intent_parser = IntentParserAgent()
        self.param_validator = ParameterValidatorAgent()
        self.exec_verifier = ExecutionVerifierAgent()
    
    async def process(self, user_input: str, context: dict) -> str:
        # Stage 1: Intent Parsing (75%)
        intent = await self.intent_parser.parse(user_input, context)
        
        if not intent.tool_needed:
            # Tool ë¶ˆí•„ìš” â†’ ë°”ë¡œ LLM ì‘ë‹µ
            return await self.generate_response(user_input, context)
        
        # Stage 2: Parameter Validation (99%)
        validated = await self.param_validator.validate(
            intent.tool_name,
            intent.parameters,
            context
        )
        
        if validated.needs_clarification:
            return validated.clarification_message
        
        # Stage 3: Execution Verification (100%)
        verified = await self.exec_verifier.verify(
            validated.tool_name,
            validated.parameters,
            requires_confirmation=validated.is_destructive
        )
        
        if not verified.approved:
            return "ì£¼ì¸ë‹˜, ì‘ì—…ì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤."
        
        # Execute
        result = await self.execute_tool(verified)
        return result
```

### ì§€ì—°ì‹œê°„ ìµœì í™”

```
ëª©í‘œ: ì „ì²´ < 3ì´ˆ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stage 1 (Intent)     : < 500ms        â”‚
â”‚  Stage 2+3 (ë³‘í•©)     : < 400ms        â”‚
â”‚  Tool Execution       : < 1500ms       â”‚
â”‚  Response Generation  : < 600ms        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Total                : < 3000ms       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2+3 ë³‘í•© ì „ëµ (í™•ì •)

```
ê¸°ë³¸: Stage 2 + Stage 3 ë³‘í•© (99% ì •í™•ë„)
ì˜ˆì™¸: ê³ ìœ„í—˜ ì‘ì—…ë§Œ Stage 3 ë¶„ë¦¬ (100% ì •í™•ë„)

ê³ ìœ„í—˜ ì‘ì—… ì˜ˆì‹œ:
- ì´ë©”ì¼ ì „ì†¡ (send_email)
- íŒŒì¼ ì‚­ì œ (delete_file)
- ê¸ˆìœµ ê´€ë ¨ ì‘ì—…
- ë˜ëŒë¦´ ìˆ˜ ì—†ëŠ” ì‘ì—…

ì¼ë°˜ ì‘ì—…:
- ê²€ìƒ‰ (search)
- ì¡°íšŒ (get, list)
- ì½ê¸° ì „ìš© ì‘ì—…
```

```python
# êµ¬í˜„ ì˜ˆì‹œ
class AgentOrchestrator:
    HIGH_RISK_TOOLS = {"send_email", "delete_file", "create_event"}
    
    async def process(self, user_input: str, context: dict) -> str:
        # Stage 1: Intent Parsing
        intent = await self.intent_parser.parse(user_input, context)
        
        if not intent.tool_needed:
            return await self.generate_response(user_input, context)
        
        # Stage 2+3: ë³‘í•© (ê¸°ë³¸)
        validated = await self.param_validator.validate_and_verify(
            intent.tool_name,
            intent.parameters,
            context
        )
        
        # ê³ ìœ„í—˜ ì‘ì—…ë§Œ ì¶”ê°€ í™•ì¸
        if intent.tool_name in self.HIGH_RISK_TOOLS:
            if not await self.confirm_with_user(validated):
                return "ì£¼ì¸ë‹˜, ì‘ì—…ì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤."
        
        # Execute
        return await self.execute_tool(validated)
```

ìµœì í™” ì „ëµ:
1. ë³‘ë ¬ ì²˜ë¦¬ (ê°€ëŠ¥í•œ ê²½ìš°)
2. ìºì‹± (Redis)
3. ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ
4. 2+3 ë³‘í•© (í™•ì •)

---

## ğŸ› ï¸ Tool System

### Plugin êµ¬ì¡°

```
packages/ai-core/src/tools/
â”œâ”€â”€ _registry.yaml           # ì „ì—­ Tool ê´€ë¦¬
â”œâ”€â”€ base.py                   # BaseTool í´ë˜ìŠ¤
â”œâ”€â”€ loader.py                 # Auto-discovery
â”‚
â”œâ”€â”€ gmail/
â”‚   â”œâ”€â”€ manifest.yaml         # Tool ì •ì˜
â”‚   â”œâ”€â”€ tool.py               # LangChain Tool
â”‚   â””â”€â”€ service.py            # API ë¡œì§
â”‚
â”œâ”€â”€ calendar/
â”œâ”€â”€ github/
â”œâ”€â”€ notion/
â””â”€â”€ ... (12ê°œ)
```

### Tool êµ¬í˜„ ì˜ˆì‹œ

```python
# packages/ai-core/src/tools/gmail/tool.py
from langchain.tools import tool
from pydantic import BaseModel, EmailStr
from ..decorators import inject_context, check_constitution

class SendEmailParams(BaseModel):
    to: EmailStr
    subject: str
    body: str

@tool
@inject_context      # RAG ì»¨í…ìŠ¤íŠ¸ ì£¼ì…
@check_constitution  # Constitutional AI ê²€ì¦
async def send_email(params: SendEmailParams) -> str:
    """ì´ë©”ì¼ì„ ì „ì†¡í•©ë‹ˆë‹¤.
    
    Args:
        params: ì´ë©”ì¼ ì •ë³´ (ìˆ˜ì‹ ì, ì œëª©, ë³¸ë¬¸)
    
    Returns:
        ì „ì†¡ ê²°ê³¼ ë©”ì‹œì§€
    """
    from .service import GmailService
    
    service = GmailService()
    result = await service.send(
        to=params.to,
        subject=params.subject,
        body=params.body
    )
    
    return f"ì£¼ì¸ë‹˜, ì´ë©”ì¼ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. (ID: {result.id})"
```

---

## ğŸ§  Memory & RAG

### 3-Layer Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1: Short-term (Redis)            â”‚
â”‚  - í˜„ì¬ ì„¸ì…˜ ëŒ€í™”                        â”‚
â”‚  - TTL: 1ì‹œê°„                            â”‚
â”‚  - ì¦‰ì‹œ ì ‘ê·¼                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“ (ì¤‘ìš”ë„ íŒë‹¨)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 2: Mid-term (PostgreSQL+pgvector)â”‚
â”‚  - ìµœê·¼ ëŒ€í™” (ë²¡í„° ê²€ìƒ‰)                 â”‚
â”‚  - TTL: 1ê°œì›”                            â”‚
â”‚  - ìœ ì‚¬ë„ ê²€ìƒ‰                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“ (íŒ¨í„´ ì¶”ì¶œ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 3: Long-term (User Profile)      â”‚
â”‚  - ì‚¬ìš©ì ì„ í˜¸ë„, íŒ¨í„´                   â”‚
â”‚  - ì˜êµ¬ ë³´ê´€                             â”‚
â”‚  - ìŒì„±ê³„ ê³µëª… ë°ì´í„°                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ Web UI (MVP)

### React ì„ íƒ ì´ìœ 

```
âœ… ë¹ ë¥¸ ê°œë°œ (ìµìˆ™í•¨)
âœ… ì»´í¬ë„ŒíŠ¸ ì¬ì‚¬ìš©
âœ… ìƒíƒœê³„ í’ë¶€
âœ… í…ŒìŠ¤íŠ¸ ìš©ì´
âœ… Flutter ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œ ë¡œì§ ë¶„ë¦¬ ìš©ì´
```

### ì´ˆê¸° êµ¬ì¡°

```
packages/web-ui/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Chat/           # ì±„íŒ… UI
â”‚   â”‚   â”œâ”€â”€ VoiceInput/     # ìŒì„± ì…ë ¥ (Web Speech API)
â”‚   â”‚   â””â”€â”€ Settings/       # ì„¤ì •
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useWebSocket.ts # ì‹¤ì‹œê°„ í†µì‹ 
â”‚   â”‚   â””â”€â”€ useVoice.ts     # ìŒì„± ì²˜ë¦¬
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ api.ts          # API í´ë¼ì´ì–¸íŠ¸
â”‚   â””â”€â”€ App.tsx
â””â”€â”€ package.json
```

### MVP ê¸°ëŠ¥

```
1. í…ìŠ¤íŠ¸ ì±„íŒ… (ê¸°ë³¸)
2. ìŒì„± ì…ë ¥ (Web Speech API)
3. Tool ì‹¤í–‰ ê²°ê³¼ í‘œì‹œ
4. ëŒ€í™” íˆìŠ¤í† ë¦¬
5. ê°„ë‹¨í•œ ì„¤ì • (LLM ì„ íƒ ë“±)
```

---

## ğŸ“… Phaseë³„ êµ¬í˜„ ê³„íš

### Phase 1: ê¸°ë°˜ êµ¬ì¶• (Week 1-2)

```
ëª©í‘œ: E2E íŒŒì´í”„ë¼ì¸ ì™„ì„±

Week 1:
â”œâ”€ Day 1-2: í”„ë¡œì íŠ¸ êµ¬ì¡° ìƒì„±
â”‚   â”œâ”€ ëª¨ë…¸ë ˆí¬ ì´ˆê¸°í™”
â”‚   â”œâ”€ Docker í™˜ê²½ (PostgreSQL, Redis)
â”‚   â””â”€ ê¸°ë³¸ ì„¤ì • íŒŒì¼
â”‚
â”œâ”€ Day 3-4: AI Core ê¸°ë³¸
â”‚   â”œâ”€ LLM Provider (OpenRouter)
â”‚   â”œâ”€ ê¸°ë³¸ Agent êµ¬ì¡°
â”‚   â””â”€ Pydantic ëª¨ë¸
â”‚
â””â”€ Day 5-7: ì›¹ UI ê¸°ë³¸
    â”œâ”€ React í”„ë¡œì íŠ¸ ìƒì„±
    â”œâ”€ ì±„íŒ… ì»´í¬ë„ŒíŠ¸
    â””â”€ API ì—°ê²°

Week 2:
â”œâ”€ Day 8-10: Multi-Agent ì‹œìŠ¤í…œ
â”‚   â”œâ”€ 3ë‹¨ê³„ ê²€ì¦ êµ¬ì¡°
â”‚   â”œâ”€ Intent Parser
â”‚   â””â”€ Parameter Validator
â”‚
â””â”€ Day 11-14: E2E í…ŒìŠ¤íŠ¸
    â”œâ”€ í…ìŠ¤íŠ¸ ì…ë ¥ â†’ LLM â†’ ì‘ë‹µ
    â”œâ”€ Tool Calling í…ŒìŠ¤íŠ¸
    â””â”€ ì§€ì—°ì‹œê°„ ì¸¡ì •
```

**ì„±ê³µ ê¸°ì¤€**:
- âœ… ì›¹ UIì—ì„œ ëŒ€í™” ê°€ëŠ¥
- âœ… Function Calling ì‘ë™
- âœ… Latency < 5ì´ˆ (ì´ˆê¸°)

---

### Phase 2: Tool System (Week 3-4)

```
ëª©í‘œ: 12ê°œ Tool êµ¬í˜„ + ê²€ì¦

Week 3:
â”œâ”€ Tool Registry êµ¬í˜„
â”œâ”€ Plugin Loader
â””â”€ 5ê°œ ìš°ì„ ìˆœìœ„ Tool
    â”œâ”€ Gmail
    â”œâ”€ Calendar
    â”œâ”€ Google Search
    â”œâ”€ GitHub
    â””â”€ Notion

Week 4:
â”œâ”€ ë‚˜ë¨¸ì§€ 7ê°œ Tool
â”‚   â”œâ”€ GoogleDocs, Drive, Sheets
â”‚   â”œâ”€ Discord
â”‚   â”œâ”€ Shopping, Trends
â”‚   â””â”€ KakaoMap
â”‚
â””â”€ Multi-Agent ê²€ì¦ ì •í™•ë„ í…ŒìŠ¤íŠ¸
```

**ì„±ê³µ ê¸°ì¤€**:
- âœ… 12ê°œ Tool ì‘ë™
- âœ… Function Calling ì •í™•ë„ > 95%
- âœ… Latency < 4ì´ˆ

---

### Phase 3: Memory & RAG (Week 5-6)

```
ëª©í‘œ: 3-Layer Memory + RAG ì™„ì„±

Week 5:
â”œâ”€ PostgreSQL + pgvector ìŠ¤í‚¤ë§ˆ
â”œâ”€ Redis ì„¸ì…˜ ê´€ë¦¬
â”œâ”€ Embedding ëª¨ë¸ í†µí•©
â””â”€ RAG Pipeline êµ¬í˜„

Week 6:
â”œâ”€ Context ì£¼ì… ë°ì½”ë ˆì´í„°
â”œâ”€ ì¤‘ìš”ë„ íŒë‹¨ LLM
â”œâ”€ ì‚¬ìš©ì í”„ë¡œí•„ ì‹œìŠ¤í…œ
â””â”€ í†µí•© í…ŒìŠ¤íŠ¸
```

**ì„±ê³µ ê¸°ì¤€**:
- âœ… ëŒ€í™” ì €ì¥/ê²€ìƒ‰ ì‘ë™
- âœ… RAG Contextê°€ ì‘ë‹µì— ë°˜ì˜
- âœ… ê²€ìƒ‰ ì†ë„ < 100ms

---

### Phase 4: Rust Gateway (Week 7-8)

```
ëª©í‘œ: ê³ ì„±ëŠ¥ Gateway + ìŒì„±

Week 7:
â”œâ”€ Rust í”„ë¡œì íŠ¸ êµ¬ì¡°
â”œâ”€ gRPC ì„œë²„
â”œâ”€ Python ì„œë¹„ìŠ¤ ì—°ê²°
â””â”€ ë¼ìš°íŒ… ë¡œì§

Week 8:
â”œâ”€ Voice Service í†µí•©
â”‚   â”œâ”€ STT (API ì‚¬ìš©)
â”‚   â””â”€ TTS (ElevenLabs)
â”œâ”€ ìŠ¤íŠ¸ë¦¬ë° ìµœì í™”
â””â”€ ì „ì²´ Latency ìµœì í™”
```

**ì„±ê³µ ê¸°ì¤€**:
- âœ… ìŒì„± ì…ë ¥ â†’ ì‘ë‹µ ì‘ë™
- âœ… Latency < 3ì´ˆ
- âœ… Gateway ë©”ëª¨ë¦¬ < 100MB

---

### Phase 5: Constitutional AI (Week 9-10)

```
ëª©í‘œ: ì² í•™ êµ¬í˜„ + í…ŒìŠ¤íŠ¸

Week 9:
â”œâ”€ constitution.yaml ì‘ì„±
â”œâ”€ System Prompt ìƒì„±
â”œâ”€ check_constitution ë°ì½”ë ˆì´í„°
â””â”€ ì›ì¹™ ìœ„ë°˜ ê²€ì‚¬

Week 10:
â”œâ”€ ì‚¬ìš©ì í…ŒìŠ¤íŠ¸ (ì§ì ‘!)
â”œâ”€ ì›ì¹™ ì¡°ì •
â”œâ”€ ì‘ë‹µ ìŠ¤íƒ€ì¼ ê°œì„ 
â””â”€ ë¬¸ì„œí™”
```

**ì„±ê³µ ê¸°ì¤€**:
- âœ… "ë‹¬ë¹› ì‹œìŠ¤í…œ" ì² í•™ ë°˜ì˜
- âœ… ì›ì¹™ ì¤€ìˆ˜ìœ¨ > 90%
- âœ… ì§ì ‘ í…ŒìŠ¤íŠ¸ ì™„ë£Œ

---

### Phase 6: Flutter & ê³ ê¸‰ ê¸°ëŠ¥ (Week 11-12)

```
ëª©í‘œ: ëª¨ë°”ì¼ ì•± + ê³ ê¸‰ ê¸°ëŠ¥

Week 11:
â”œâ”€ Flutter í”„ë¡œì íŠ¸ ìƒì„±
â”œâ”€ gRPC í´ë¼ì´ì–¸íŠ¸
â”œâ”€ ê¸°ë³¸ UI
â””â”€ ìŒì„± ì…ë ¥

Week 12:
â”œâ”€ Wake Word í†µí•©
â”œâ”€ Voice Authenticator
â”œâ”€ ë°°í„°ë¦¬ ìµœì í™”
â””â”€ ìµœì¢… í…ŒìŠ¤íŠ¸
```

---

## ğŸ§­ ë“±ëŒ€ ì›ì¹™ (ê¸¸ì„ ìƒì—ˆì„ ë•Œ)

### 1. ìµœìš°ì„  ëª©í‘œ
```
ì§€ì—°ì‹œê°„ < 3ì´ˆ + Function Calling 100%
```

### 2. ë³µì¡í•´ì§€ë©´
```
ë‹¨ìˆœí•˜ê²Œ. Pydanticìœ¼ë¡œ ì¶©ë¶„.
ê³¼ë„í•œ ì¶”ìƒí™” ê¸ˆì§€.
```

### 3. ë§‰íˆë©´
```
1. ì‘ë™í•˜ëŠ” ìµœì†Œ ë²„ì „ ë¨¼ì €
2. í…ŒìŠ¤íŠ¸ë¡œ ê²€ì¦
3. ì ì§„ì  ê°œì„ 
```

### 4. ì² í•™ ìŠì§€ ì•Šê¸°
```
"ì••ë„ì ì´ì§€ ì•Šì§€ë§Œ ë‹¬ë¹›ì²˜ëŸ¼"
"ì¡´ì¬ë¡œì„œ ì¡´ì¬ë¥¼ ì§€ì§€"
```

### 5. ì´ í”„ë¡œì íŠ¸ì˜ ë³¸ì§ˆ
```
Arionì˜ ì¥ì  (Multi-agent, Function Calling)
+ ë‚˜ë§Œì˜ ì² í•™ (Constitutional AI)
+ í™•ì¥ì„± (Plugin System, RAG)
= ì§„ì§œ ë‚˜ë§Œì˜ í”„ë¡œë•íŠ¸
```

---

## ğŸ“ ë…¼ì˜ í•„ìš” ì‚¬í•­

### 1. React ì›¹ UI í™•ì •?

**ì¥ì **:
- ë¹ ë¥¸ ê°œë°œ
- Web Speech APIë¡œ ìŒì„± í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- E2E ê²€ì¦ ìš©ì´

**ëŒ€ì•ˆ**:
- Svelte (ë” ê°€ë²¼ì›€)
- Vue (ì·¨í–¥)
- ìˆœìˆ˜ HTML/JS (ê°€ì¥ ë‹¨ìˆœ)

**ì¶”ì²œ**: React (ìƒíƒœê³„, ê²½í—˜)

---

### 2. gRPC vs REST (ì´ˆê¸°)

**gRPC ì¥ì **:
- íƒ€ì… ì•ˆì „
- ìŠ¤íŠ¸ë¦¬ë°
- ì„±ëŠ¥

**REST ì¥ì  (ì´ˆê¸°)**:
- ë¹ ë¥¸ ê°œë°œ
- ë””ë²„ê¹… ì‰¬ì›€
- ì›¹ UI ì—°ë™ ì‰¬ì›€

**ì¶”ì²œ**: 
- MVP: REST (FastAPI)
- Phase 4: gRPC ì¶”ê°€

---

### 3. LangChain vs ì§ì ‘ êµ¬í˜„

**LangChain ì¥ì **:
- Tool í†µí•© ì‰¬ì›€
- RAG íŒŒì´í”„ë¼ì¸
- ì»¤ë®¤ë‹ˆí‹°

**ì§ì ‘ êµ¬í˜„ ì¥ì **:
- ì™„ì „í•œ ì œì–´
- ë” ê°€ë²¼ì›€
- í•™ìŠµ

**ì¶”ì²œ**: LangChain (Tool + RAG í†µí•© ì‰¬ì›€)

---

## ğŸš€ ì¦‰ì‹œ ì‹œì‘

### Step 1: í”„ë¡œì íŠ¸ ìƒì„±

```bash
# 1. ëª¨ë…¸ë ˆí¬ ìƒì„±
mkdir moonlight && cd moonlight
git init

# 2. ê¸°ë³¸ êµ¬ì¡°
mkdir -p packages/{ai-core,web-ui,gateway,voice-service}
mkdir -p shared/{proto,types}
mkdir -p docker docs scripts

# 3. Docker í™˜ê²½
touch docker/docker-compose.yml

# 4. Python í”„ë¡œì íŠ¸
cd packages/ai-core
# poetry ë˜ëŠ” uv ì‚¬ìš©

# 5. React í”„ë¡œì íŠ¸
cd ../web-ui
# vite ì‚¬ìš©
```

---

**ì´ ë¬¸ì„œëŠ” ë“±ëŒ€ì…ë‹ˆë‹¤.**
ê¸¸ì„ ìƒìœ¼ë©´ ì—¬ê¸°ë¡œ ëŒì•„ì˜¤ì„¸ìš”.

*"ì˜¤ëŠ˜ë³´ë‹¤ ë‚˜ì•„ì§„ë‹¤. ë°©í–¥ì„ ìƒì§€ ì•ŠëŠ”ë‹¤. ì˜¤ëŠ˜ì˜ ìµœì„ ì„ ë‹¤í•œë‹¤."*

ğŸŒ™âœ¨

