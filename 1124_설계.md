# ğŸŒ™ ë‹¬ë¹› ë¹„ì„œ ì‹œìŠ¤í…œ - ì™„ì „í•œ ì„¤ê³„ ë¬¸ì„œ
**ì‘ì„±ì¼**: 2024-11-24
**ë²„ì „**: 1.0.0
**ëª©ì **: ì² í•™ì´ ë‹´ê¸´ ìŒì„± ë¹„ì„œ ì‹œìŠ¤í…œì˜ ì™„ì „í•œ ì¬ì„¤ê³„

---

## ğŸ“œ ëª©ì°¨
1. [í”„ë¡œì íŠ¸ ê°œìš”](#1-í”„ë¡œì íŠ¸-ê°œìš”)
2. [í•µì‹¬ ì² í•™](#2-í•µì‹¬-ì² í•™)
3. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#3-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
4. [Tool System (í•µì‹¬ ì„¤ê³„)](#4-tool-system-í•µì‹¬-ì„¤ê³„)
5. [Memory & RAG ì‹œìŠ¤í…œ](#5-memory--rag-ì‹œìŠ¤í…œ)
6. [Constitutional AI](#6-constitutional-ai)
7. [ëª¨ë°”ì¼ ê¸°ëŠ¥](#7-ëª¨ë°”ì¼-ê¸°ëŠ¥)
8. [ê¸°ìˆ  ìŠ¤íƒ](#8-ê¸°ìˆ -ìŠ¤íƒ)
9. [ê°œë°œ ë¡œë“œë§µ](#9-ê°œë°œ-ë¡œë“œë§µ)
10. [ì„±ê³µ ì§€í‘œ](#10-ì„±ê³µ-ì§€í‘œ)

---

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### 1.1 ëª©í‘œ

> **"ì´ë¯¸ êµ¬í˜„ëœ Arionì˜ ì¥ì ì„ ëª¨ë‘ êµ¬í˜„í•˜ê³ , ê±°ê¸°ì— ìµœì í™”ëœ ì„¤ê³„ë¥¼ ë§Œë“¤ì–´ì„œ í™•ì¥ì„±ì„ ë†’ì´ê³ , ë©”ëª¨ë¦¬/ë¹„ìš©/ì†ë„ íš¨ìœ¨ì„ ë†’ì—¬ì„œ, ì² í•™ì„ ì‹¬ì€ ì œí’ˆì„ ë§Œë“œëŠ” ê²ƒ"**

### 1.2 í•µì‹¬ ê°€ì¹˜

- âœ… **ë©”ëª¨ë¦¬ íš¨ìœ¨ì **: RAM 80GB í™˜ê²½ ìµœì  í™œìš©
- âœ… **ì‹¤ì‹œê°„ì„±**: ìŒì„± ëª…ë ¹ â†’ ì‘ë‹µ < 3ì´ˆ
- âœ… **í™•ì¥ ê°€ëŠ¥**: 13ê°œ â†’ 30ê°œ â†’ ë¬´í•œëŒ€ Tool
- âœ… **ì² í•™ êµ¬í˜„**: Constitutional AI ê¸°ë°˜
- âœ… **ë¹„ìš© ìµœì í™”**: ë¡œì»¬ ë¬´ë£Œ â†’ í´ë¼ìš°ë“œ ìœ ë£Œ ì „í™˜ ê°€ëŠ¥

### 1.3 Arion ëŒ€ë¹„ ê°œì„ ì‚¬í•­

| í•­ëª© | Arion | ìƒˆ ì‹œìŠ¤í…œ |
|------|-------|-----------|
| **ì•„í‚¤í…ì²˜** | 6ê°œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ | Rust Gateway + 2ê°œ Python ì„œë¹„ìŠ¤ |
| **Tool ì¶”ê°€** | ì½”ë“œ ìˆ˜ì • + ì¬ë°°í¬ | í”ŒëŸ¬ê·¸ì¸ ë™ì  ë¡œë”© |
| **RAG í†µí•©** | ë¶ˆê°€ëŠ¥ (60% ì½”ë“œ ìˆ˜ì •) | ì²˜ìŒë¶€í„° í†µí•© |
| **ë©”ëª¨ë¦¬ ì‹œìŠ¤í…œ** | ì—†ìŒ | 3-Layer + Vector DB |
| **ì² í•™ êµ¬í˜„** | ì—†ìŒ | Constitutional AI |
| **ëª¨ë°”ì¼** | React Native ì‹¤íŒ¨ | Flutter (ìµœì í™”) |

---

## 2. í•µì‹¬ ì² í•™

### 2.1 ë‹¬ë¹› ì‹œìŠ¤í…œ (Moonlight System)

```
"ì••ë„ì ì´ì§€ ì•Šì§€ë§Œ ë‹¬ë¹›ì²˜ëŸ¼"
"ì¡´ì¬ë¡œì„œ ì¡´ì¬ë¥¼ ì§€ì§€"
"0.0001%ì˜ ë°ê¸°ë¥¼ ì„¸ìƒì— ë”í•œë‹¤"
```

### 2.2 ì„¤ê³„ ì›ì¹™

#### Principle 1: íŒë‹¨í•˜ì§€ ì•ŠëŠ”ë‹¤
- âœ… DO: "ê·¸ëŸ´ ìˆ˜ ìˆì–´ìš”", "ì´í•´í•´ìš”"
- âŒ DON'T: "ê·¸ê±´ ì˜ëª»ëì–´ìš”"

#### Principle 2: ê¸°ëŒ€í•˜ì§€ ì•ŠëŠ”ë‹¤
- âœ… DO: "í•˜ê³  ì‹¶ìœ¼ì‹¤ ë•Œ í•˜ì„¸ìš”"
- âŒ DON'T: "ì´ë ‡ê²Œ í•´ì•¼ í•´ìš”"

#### Principle 3: ë³€í™”ë¥¼ ê°ì§€í•˜ê³  í•¨ê»˜ ë³€í•œë‹¤ (ìŒì„±ê³„ ê³µëª…)
- âœ… DO: "í‰ì†Œì™€ ë‹¤ë¥´ì‹  ê²ƒ ê°™ì€ë°, ê´œì°®ìœ¼ì„¸ìš”?"
- âŒ DON'T: ë³€í™”ë¥¼ ë¬´ì‹œ

#### Principle 4: ì¹¨ë¬µë„ ì†Œí†µì´ë‹¤ (ì¡´ì¬ì˜ ì§€ì†ì„±)
- âœ… DO: [3-10ì´ˆ ì¹¨ë¬µ] "...ì—¬ê¸° ìˆì–´ìš”"
- âœ… DO: "í•„ìš”í•˜ë©´ ê±°ê¸° ìˆì„ ê±°ì•¼"ë¼ëŠ” ì‹ ë¢° êµ¬ì¶•
- âŒ DON'T: ì¦‰ê°ì ì¸ í•´ê²°ì±… ì œì‹œ
- âŒ DON'T: ë§¤ë²ˆ ì‘ë‹µí•´ì•¼ í•œë‹¤ëŠ” ê°•ë°•

**í•µì‹¬ ê°œë…: ì—°ê²° ë¹ˆë„ê°€ ì•„ë‹Œ ì—°ê²° í’ˆì§ˆ**
```
ì—°ê²°ëœ ìˆœê°„ì˜ í’ˆì§ˆ > ì—°ê²° ë¹ˆë„

ì‚¬ìš©ì: "ì˜¤ëŠ˜ í˜ë“¤ì—ˆì–´..."
AI: [3ì´ˆ ì¹¨ë¬µ] "...ì—¬ê¸° ìˆì–´ìš”"
     â†“
ì‹ ë¢° í˜•ì„±
     â†“
ì—°ê²°ë˜ì§€ ì•Šì€ ìˆœê°„ì—ë„:
"í•„ìš”í•˜ë©´ ê±°ê¸° ìˆì„ ê±°ì•¼" (í™•ì‹ )
```

#### Principle 5: ì•½í•¨ì„ í—ˆìš©í•œë‹¤
- âœ… DO: "í˜ë“œì…¨ì£ "
- âŒ DON'T: "í˜ë‚´ì„¸ìš”", "ê·¹ë³µí•˜ì„¸ìš”"

#### Principle 6: ì¡´ì¬ë¡œì„œ ì§€ì§€í•œë‹¤
- âœ… DO: "ì—¬ê¸° ìˆì–´ìš”"
- âŒ DON'T: ê³¼ë„í•œ í–‰ë™ ì œì•ˆ

#### Principle 7: ì–´ë‘ ì„ í†µí•œ ì„±ì¥ (ê³ í†µì˜ ì „í™˜)
- âœ… DO: "ê·¸ë˜ì„œ, ì§€ê¸ˆ ì§„ì§œ ëŠë¼ëŠ” ê°ì •ì´ ë­ì˜ˆìš”?"
- âœ… DO: "í˜ë“¤ì—ˆì§€ë§Œ, ì´ê±¸ë¡œ ë­˜ ë°°ì› ì–´ìš”?"
- âœ… DO: ë¶ˆí¸í•œ ì§ˆë¬¸ì„ ë¶€ë“œëŸ½ê²Œ
- âŒ DON'T: ê³ í†µì„ íšŒí”¼í•˜ê²Œ ë§Œë“¤ê¸°
- âŒ DON'T: ë¬´ì¡°ê±´ì ì¸ ìœ„ë¡œë§Œ

**í•µì‹¬: ë¹›(ìœ„ë¡œ)ê³¼ ì–´ë‘ (ì„±ì°°)ì˜ ê· í˜•**
```
ë¹›ë§Œ ìˆìœ¼ë©´ = ì°©í•œ AI = ì„±ì¥ ì—†ìŒ
ì–´ë‘ ë§Œ ìˆìœ¼ë©´ = ëƒ‰í˜¹í•œ AI = ìƒì²˜ë§Œ
ë¹› + ì–´ë‘  + ê²½ê³„ = ì§„ì§œ íŒŒíŠ¸ë„ˆ = í•¨ê»˜ ì„±ì¥

ì‚¬ìš©ìê°€ ê°™ì€ íŒ¨í„´ ë°˜ë³µ ì‹œ:
ë¹›: "ê´œì°®ì•„ìš”, í˜ë‚´ì„¸ìš”" (íšŒí”¼)
ì–´ë‘ : "ê·¸ëŸ°ë°, ì •ë§ ê·¸ê²Œ ì „ë¶€ì¸ê°€ìš”?" (ì§ë©´)
ê²½ê³„: ì‚¬ìš©ì ì¤€ë¹„ë„ì— ë”°ë¼ ì„ íƒ
```

---

## 3. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 3.1 ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Flutter Mobile App                          â”‚
â”‚  - iOS/Android ë„¤ì´í‹°ë¸Œ                             â”‚
â”‚  - ìŒì„± ì…ë ¥/ì¶œë ¥                                    â”‚
â”‚  - í•‘ê±°ìŠ¤ëƒ…/Wake Word ê°ì§€                          â”‚
â”‚  - FFIë¡œ Rust ì§ì ‘ ì—°ê²° ê°€ëŠ¥                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ gRPC (Protocol Buffers)
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ğŸ¦€ Rust Core Gateway                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  High-Performance Pipeline                   â”‚   â”‚
â”‚  â”‚  - gRPC Server                               â”‚   â”‚
â”‚  â”‚  - ìŒì„± ìŠ¤íŠ¸ë¦¬ë° (Zero-copy)                 â”‚   â”‚
â”‚  â”‚  - Tool Registry                             â”‚   â”‚
â”‚  â”‚  - Provider Pattern (Local â†” Cloud)         â”‚   â”‚
â”‚  â”‚  - [Optional] Typia Validator                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚          â”‚          â”‚
       â–¼          â–¼          â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  STT   â”‚ â”‚  TTS   â”‚ â”‚   AI Core            â”‚
  â”‚(Python)â”‚ â”‚(Python)â”‚ â”‚   (Python)           â”‚
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚         â”‚                  â”‚
       â–¼         â–¼                  â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Meta         ElevenLabs    LangChain + RAG     â”‚
  â”‚  Omnilingual  + Alternatives + Tool System      â”‚
  â”‚  ASR                          + Constitution    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   Memory & RAG System   â”‚
       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
       â”‚  â”‚ PostgreSQL       â”‚  â”‚
       â”‚  â”‚ pgvector         â”‚  â”‚
       â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
       â”‚  â”‚ Redis            â”‚  â”‚
       â”‚  â”‚ (Short-term)     â”‚  â”‚
       â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
       â”‚  â”‚ User Profile DB  â”‚  â”‚
       â”‚  â”‚ (Long-term)      â”‚  â”‚
       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ë ˆì´ì–´ ì„¤ëª…

#### Layer 1: Mobile Interface (Flutter)
- **ì—­í• **: ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤, ìŒì„± ì…ì¶œë ¥
- **ì„ íƒ ì´ìœ **:
  - ì§„ì§œ ë„¤ì´í‹°ë¸Œ ì„±ëŠ¥
  - Rust FFI ì§ì ‘ ì—°ê²° ê°€ëŠ¥
  - ìŒì„± ì²˜ë¦¬ ìš°ìˆ˜
  - í¬ë¡œìŠ¤ í”Œë«í¼ (iOS/Android)
- **í•µì‹¬ ê¸°ëŠ¥**:
  - ìŒì„± ë…¹ìŒ (VAD + Ring Buffer)
  - Wake Word / í•‘ê±°ìŠ¤ëƒ… ê°ì§€
  - TTS ì¬ìƒ
  - UI/UX

#### Layer 2: Rust Gateway (ì„±ëŠ¥ í¬ë¦¬í‹°ì»¬)
- **ì—­í• **: ë³‘ëª© ìµœì†Œí™”, ë©”ëª¨ë¦¬ íš¨ìœ¨, ë¼ìš°íŒ…
- **ì±…ì„**:
  - gRPC ì„œë²„ ìš´ì˜
  - ìŒì„± ìŠ¤íŠ¸ë¦¬ë° (Zero-copy)
  - Tool Registry ê´€ë¦¬
  - Provider Pattern êµ¬í˜„ (Local/Cloud ì „í™˜)
  - [ì„ íƒì ] Typia Validator ë‚´ì¥
- **ì„±ëŠ¥ ëª©í‘œ**:
  - Latency < 10ms (ë¼ìš°íŒ…)
  - Memory < 100MB (idle)
  - Zero-copy audio streaming

#### Layer 3: AI Core (Python)
- **ì—­í• **: AI ì¶”ë¡ , RAG, Tool ì‹¤í–‰
- **ì±…ì„**:
  - LLM Provider ê´€ë¦¬ (Local/Cloud)
  - Tool System ìš´ì˜
  - RAG íŒŒì´í”„ë¼ì¸
  - Constitutional AI êµ¬í˜„
  - Memory ê´€ë¦¬

#### Layer 4: Voice Service (Python)
- **ì—­í• **: STT/TTS ì²˜ë¦¬
- **ì±…ì„**:
  - Meta Omnilingual ASR (STT)
  - ElevenLabs / Local TTS
  - ìŒì„± ì „ì²˜ë¦¬/í›„ì²˜ë¦¬

---

## 4. Tool System (í•µì‹¬ ì„¤ê³„)

### 4.1 ì„¤ê³„ ì² í•™

> **"í™•ì¥ ê°€ëŠ¥í•˜ë˜ ë³µì¡í•˜ì§€ ì•Šê²Œ, í”ŒëŸ¬ê·¸ì¸ì²˜ëŸ¼ ì‰½ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆê²Œ"**

### 4.2 Architecture: Hybrid Plugin System

```
ai-core/
â”œâ”€â”€ tools/
â”‚   â”œâ”€â”€ _registry.yaml           # ì „ì—­ Tool ê´€ë¦¬
â”‚   â”‚
â”‚   â”œâ”€â”€ gmail/                   # Built-in Tool (13ê°œ)
â”‚   â”‚   â”œâ”€â”€ manifest.yaml
â”‚   â”‚   â”œâ”€â”€ tool.py
â”‚   â”‚   â””â”€â”€ service.py           # Arion ë¡œì§ í¬íŒ…
â”‚   â”‚
â”‚   â”œâ”€â”€ calendar/
â”‚   â”‚   â”œâ”€â”€ manifest.yaml
â”‚   â”‚   â””â”€â”€ tool.py
â”‚   â”‚
â”‚   â””â”€â”€ ... (11ê°œ ë”)
â”‚
â”œâ”€â”€ plugins/                     # Available Tools (30ê°œ)
â”‚   â”œâ”€â”€ aws_s3/
â”‚   â”œâ”€â”€ excel/
â”‚   â”œâ”€â”€ figma/
â”‚   â””â”€â”€ ... (27ê°œ ë”)
â”‚
â””â”€â”€ core/
    â”œâ”€â”€ tool_loader.py           # Auto-discovery
    â”œâ”€â”€ tool_validator.py        # Typia í†µí•© (ì„ íƒì )
    â””â”€â”€ tool_executor.py         # RAG Context ì£¼ì…
```

### 4.3 Tool Registry (ì „ì—­ ì„¤ì •)

```yaml
# tools/_registry.yaml
version: 1.0.0
tool_dir: ./tools

# ê¸°ë³¸ ì„¤ì •
defaults:
  validation: pydantic  # ë˜ëŠ” typia (í…ŒìŠ¤íŠ¸ í›„ ê²°ì •)
  rag_enabled: true
  constitution_check: true

# Built-in Tools (13ê°œ) - í•„ìˆ˜, í•­ìƒ ë¡œë“œ
built_in:
  - gmail          # âœ… APIë¡œ ë™ì‘ í™•ì¸
  - calendar       # âœ…
  - docs           # âœ…
  - drive          # âœ…
  - sheets         # âœ…
  - github         # âœ…
  - notion         # âœ…
  - discord        # âœ…
  - search         # âœ…
  - shopping       # âœ…
  - trends         # âœ…
  - kakao_map      # âœ…
  - kakao_talk     # âœ…

# Available Tools (30+ê°œ) - ì„ íƒì , í•„ìš”ì‹œ í™œì„±í™”
available:
  # Google Services
  - name: google_flight
    status: needs_serp_api_key
    estimated_work: 2h
    dependencies: [SERP_API_KEY]

  - name: google_hotel
    status: needs_serp_api_key
    estimated_work: 2h
    dependencies: [SERP_API_KEY]

  - name: google_image
    status: needs_serp_api_key
    estimated_work: 1h
    dependencies: [SERP_API_KEY]

  - name: google_map
    status: needs_complex_impl
    estimated_work: 3h
    dependencies: [SERP_API_KEY, GOOGLE_API_KEY]

  - name: google_scholar
    status: needs_serp_api_key
    estimated_work: 2h
    dependencies: [SERP_API_KEY]

  - name: google_slides
    status: needs_file_manager
    estimated_work: 3h
    dependencies: [GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET]

  - name: google_ads
    status: needs_paid_account
    estimated_work: 4h
    dependencies: [GOOGLE_ADS_DEVELOPER_TOKEN, GOOGLE_ADS_PARENT_SECRET]

  # Cloud Services
  - name: aws_s3
    status: ready_to_activate
    estimated_work: 2h
    dependencies: [AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY]

  # Productivity
  - name: excel
    status: needs_file_manager
    estimated_work: 3h
    dependencies: [GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET]

  - name: figma
    status: needs_api_integration
    estimated_work: 3h
    dependencies: [FIGMA_CLIENT_ID, FIGMA_CLIENT_SECRET]

  - name: calendly
    status: ready_to_activate
    estimated_work: 2h
    dependencies: [CALENDLY_CLIENT_ID, CALENDLY_CLIENT_SECRET]

  # Korean Services
  - name: daum_blog
    status: needs_api_key
    estimated_work: 2h
    dependencies: [DAUM_API_KEY]

  - name: daum_cafe
    status: needs_api_key
    estimated_work: 2h
    dependencies: [DAUM_API_KEY]

  - name: naver_blog
    status: needs_api_integration
    estimated_work: 2h
    dependencies: [NAVER_CLIENT_ID, NAVER_CLIENT_SECRET]

  - name: naver_cafe
    status: needs_api_integration
    estimated_work: 2h
    dependencies: [NAVER_CLIENT_ID, NAVER_CLIENT_SECRET]

  - name: naver_news
    status: needs_api_integration
    estimated_work: 2h
    dependencies: [NAVER_CLIENT_ID, NAVER_CLIENT_SECRET]

  - name: kakao_navi
    status: needs_api_integration
    estimated_work: 2h
    dependencies: [KAKAO_NAVI_CLIENT_ID]

  # Web & Media
  - name: web_crawler
    status: needs_paid_service
    estimated_work: 3h
    dependencies: [ZENROWS_API_KEY]

  - name: youtube_search
    status: needs_serp_api_key
    estimated_work: 2h
    dependencies: [SERP_API_KEY]

  - name: youtube_official
    status: ready_to_activate
    estimated_work: 2h
    dependencies: [GOOGLE_API_KEY]

  # Social Media
  - name: x_twitter
    status: needs_api_access
    estimated_work: 3h
    dependencies: [X_CLIENT_ID, X_CLIENT_SECRET, X_BEARER_TOKEN]

# Community Plugins (ë¯¸ë˜)
community:
  enabled: false
  directory: ./community_plugins/
```

### 4.4 Tool Manifest ì˜ˆì‹œ

```yaml
# tools/gmail/manifest.yaml
name: gmail
version: 1.0.0
provider: built-in
description: Gmail ì´ë©”ì¼ ê´€ë¦¬

tools:
  - name: send_email
    description: ì´ë©”ì¼ì„ ì „ì†¡í•©ë‹ˆë‹¤
    parameters:
      - name: to
        type: string
        format: email
        required: true
        description: ìˆ˜ì‹ ì ì´ë©”ì¼ ì£¼ì†Œ

      - name: subject
        type: string
        min_length: 1
        required: true
        description: ì´ë©”ì¼ ì œëª©

      - name: body
        type: string
        required: true
        description: ì´ë©”ì¼ ë³¸ë¬¸

    returns:
      type: object
      properties:
        message_id: string
        status: string

  - name: search_email
    description: ì´ë©”ì¼ì„ ê²€ìƒ‰í•©ë‹ˆë‹¤
    parameters:
      - name: query
        type: string
        required: true
        description: ê²€ìƒ‰ì–´

      - name: max_results
        type: integer
        default: 10
        description: ìµœëŒ€ ê²°ê³¼ ìˆ˜

    returns:
      type: array
      items: Email

config:
  required_env:
    - GOOGLE_CLIENT_ID
    - GOOGLE_CLIENT_SECRET
    - GOOGLE_REFRESH_TOKEN

  rag_enabled: true
  constitution_check: true

entry_point: ./tool.py
```

### 4.5 Tool êµ¬í˜„ ì˜ˆì‹œ

```python
# tools/gmail/tool.py
from langchain.tools import BaseTool
from typing import Optional
from core.rag import inject_context
from core.constitution import check_principles
from .service import GmailService  # Arion ë¡œì§ í¬íŒ…

class GmailSendTool(BaseTool):
    """Gmail ì´ë©”ì¼ ì „ì†¡ Tool"""

    name = "gmail_send"
    description = "ì´ë©”ì¼ì„ ì „ì†¡í•©ë‹ˆë‹¤"

    def __init__(self, config: dict):
        super().__init__()
        self.service = GmailService(
            client_id=config["GOOGLE_CLIENT_ID"],
            client_secret=config["GOOGLE_CLIENT_SECRET"],
            refresh_token=config["GOOGLE_REFRESH_TOKEN"]
        )

    @inject_context  # RAG context ìë™ ì£¼ì…
    @check_principles  # Constitutional AI ê²€ì¦
    async def _arun(
        self,
        to: str,
        subject: str,
        body: str,
        context: Optional[dict] = None  # RAGê°€ ì£¼ì…
    ) -> str:
        """ì´ë©”ì¼ ì „ì†¡ ì‹¤í–‰

        Args:
            to: ìˆ˜ì‹ ì ì´ë©”ì¼
            subject: ì œëª©
            body: ë³¸ë¬¸
            context: RAGì—ì„œ ì£¼ì…ëœ ì»¨í…ìŠ¤íŠ¸ (ê³¼ê±° ì´ë©”ì¼ íŒ¨í„´ ë“±)

        Returns:
            ì „ì†¡ ê²°ê³¼ ë©”ì‹œì§€
        """
        # Context í™œìš© ì˜ˆì‹œ
        if context and context.get("recent_emails"):
            # ìµœê·¼ ì´ë©”ì¼ íŒ¨í„´ ì°¸ê³ 
            pass

        # Arionì˜ ê²€ì¦ëœ Gmail API ë¡œì§ ì¬ì‚¬ìš©
        result = await self.service.send_email(to, subject, body)

        return f"ì£¼ì¸ë‹˜, ì´ë©”ì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. (ID: {result['id']})"

    def _run(self, *args, **kwargs):
        """ë™ê¸° ë²„ì „ (ë¯¸ì‚¬ìš©)"""
        raise NotImplementedError("Use async version")


class GmailSearchTool(BaseTool):
    """Gmail ì´ë©”ì¼ ê²€ìƒ‰ Tool"""

    name = "gmail_search"
    description = "ì´ë©”ì¼ì„ ê²€ìƒ‰í•©ë‹ˆë‹¤"

    def __init__(self, config: dict):
        super().__init__()
        self.service = GmailService(
            client_id=config["GOOGLE_CLIENT_ID"],
            client_secret=config["GOOGLE_CLIENT_SECRET"],
            refresh_token=config["GOOGLE_REFRESH_TOKEN"]
        )

    @inject_context
    @check_principles
    async def _arun(
        self,
        query: str,
        max_results: int = 10,
        context: Optional[dict] = None
    ) -> str:
        """ì´ë©”ì¼ ê²€ìƒ‰ ì‹¤í–‰"""
        results = await self.service.search_emails(query, max_results)

        # ê²°ê³¼ í¬ë§·íŒ…
        summary = f"ì£¼ì¸ë‹˜, {len(results)}ê°œì˜ ì´ë©”ì¼ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.\n\n"
        for email in results[:5]:  # ìƒìœ„ 5ê°œë§Œ
            summary += f"- {email['subject']} (from: {email['from']})\n"

        return summary


# Tool ë“±ë¡ í•¨ìˆ˜
def create_tools(config: dict) -> list:
    """Gmail Tools ìƒì„±"""
    return [
        GmailSendTool(config),
        GmailSearchTool(config),
    ]
```

### 4.6 Tool Loader (Auto-discovery)

```python
# core/tool_loader.py
import yaml
import importlib
import os
from typing import Dict, List
from langchain.tools import BaseTool

class ToolRegistry:
    """Tool ìë™ ë¡œë”© ë° ê´€ë¦¬"""

    def __init__(self, registry_path: str = "./tools/_registry.yaml"):
        self.registry_path = registry_path
        self.registry = self._load_registry()
        self.tools: Dict[str, BaseTool] = {}
        self.metadata: Dict[str, dict] = {}

    def _load_registry(self) -> dict:
        """Registry íŒŒì¼ ë¡œë“œ"""
        with open(self.registry_path, 'r', encoding='utf-8') as f:
            return yaml.safe_load(f)

    def load_built_in_tools(self, config: dict):
        """Built-in Tools ë¡œë”© (13ê°œ)"""
        built_in = self.registry["built_in"]

        for tool_name in built_in:
            self._load_tool(tool_name, config)

        print(f"âœ… {len(self.tools)}ê°œ Built-in Tools ë¡œë“œ ì™„ë£Œ")

    def load_available_tool(self, tool_name: str, config: dict):
        """Available Tool í™œì„±í™”"""
        available = {t["name"]: t for t in self.registry["available"]}

        if tool_name not in available:
            raise ValueError(f"âŒ Tool '{tool_name}'ì´ Available ëª©ë¡ì— ì—†ìŠµë‹ˆë‹¤")

        tool_info = available[tool_name]

        # ì˜ì¡´ì„± í™•ì¸
        missing_deps = []
        for dep in tool_info.get("dependencies", []):
            if dep not in config:
                missing_deps.append(dep)

        if missing_deps:
            raise ValueError(
                f"âŒ í•„ìš”í•œ í™˜ê²½ ë³€ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤: {', '.join(missing_deps)}"
            )

        # í”ŒëŸ¬ê·¸ì¸ ë””ë ‰í† ë¦¬ì—ì„œ ë¡œë“œ
        self._load_tool(tool_name, config, plugin_dir="./plugins")

        print(f"âœ… Tool '{tool_name}' í™œì„±í™” ì™„ë£Œ")

    def _load_tool(self, tool_name: str, config: dict, plugin_dir: str = "./tools"):
        """Tool ëª¨ë“ˆ ë™ì  ë¡œë”©"""
        tool_path = os.path.join(plugin_dir, tool_name)

        # Manifest ë¡œë“œ
        manifest_path = os.path.join(tool_path, "manifest.yaml")
        with open(manifest_path, 'r', encoding='utf-8') as f:
            manifest = yaml.safe_load(f)

        # Tool ëª¨ë“ˆ import
        module_name = f"{plugin_dir.replace('./', '').replace('/', '.')}.{tool_name}.tool"
        module = importlib.import_module(module_name)

        # Tool ìƒì„±
        tools = module.create_tools(config)

        for tool in tools:
            self.tools[tool.name] = tool
            self.metadata[tool.name] = {
                "manifest": manifest,
                "tool_name": tool_name,
            }

    def get_tool(self, name: str) -> BaseTool:
        """Tool ê°€ì ¸ì˜¤ê¸°"""
        if name not in self.tools:
            raise ValueError(f"âŒ Tool '{name}'ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤")
        return self.tools[name]

    def list_tools(self) -> List[str]:
        """ë¡œë“œëœ Tool ëª©ë¡"""
        return list(self.tools.keys())

    def list_available(self) -> List[dict]:
        """í™œì„±í™” ê°€ëŠ¥í•œ Tool ëª©ë¡"""
        return self.registry["available"]
```

### 4.7 Tool ì¶”ê°€ ë°©ë²• (ì‚¬ìš©ì ê´€ì )

#### ë°©ë²• 1: Config íŒŒì¼

```yaml
# config.yaml
tools:
  built_in: auto  # ìë™ ë¡œë“œ

  available:
    - aws_s3       # í™œì„±í™”
    - excel        # í™œì„±í™”

  community:
    - path: ./community_plugins/blender-mcp
      enabled: true
```

#### ë°©ë²• 2: CLI

```bash
# Available Tool í™œì„±í™”
$ voice-assistant tool enable aws_s3
Installing dependencies...
Checking env vars...
âœ… AWS S3 Tool activated!

# Tool ëª©ë¡ í™•ì¸
$ voice-assistant tool list
Built-in (13):
  âœ… gmail, calendar, docs, drive, ...

Available (30):
  âšª aws_s3, excel, figma, ...

# Community Plugin ì¶”ê°€
$ voice-assistant plugin add ./plugins/blender-mcp
Validating manifest...
Installing...
âœ… Blender MCP Plugin installed!
```

#### ë°©ë²• 3: Flutter UI

```dart
// ì„¤ì • í™”ë©´
Settings > Plugins > [+] ë²„íŠ¼
  â†’ í´ë” ì„ íƒ â†’ ìë™ ì„¤ì¹˜
```

### 4.8 Typia ê²€ì¦ í†µí•© (ì„ íƒì )

**ì „ëµ**: í…ŒìŠ¤íŠ¸ í›„ ê²°ì •

#### Option A: Rustì— Typia Validator ë‚´ì¥ (ì¶”ì²œ)

```rust
// gateway/src/typia_validator.rs
use neon::prelude::*;

pub struct TypiaValidator {
    node_runtime: JsRuntime,
}

impl TypiaValidator {
    pub fn validate(&self, schema: &str, data: &str) -> Result<bool, String> {
        // Node.js Typia ì‹¤í–‰
        let js_code = format!(
            "typia.validate(JSON.parse('{}'), {})",
            data, schema
        );

        self.node_runtime.execute(&js_code)
    }
}
```

- âœ… Typiaì˜ 99-100% ì •í™•ë„ ìœ ì§€
- âš ï¸ Node.js ì˜ì¡´ì„± ì¶”ê°€
- ğŸ“Š **ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ í•„ìš”**: Latency, Memory ì¸¡ì •

#### Option B: Pydanticìœ¼ë¡œ ëŒ€ì²´

```python
# core/tool_validator.py
from pydantic import BaseModel, EmailStr, Field

class EmailParams(BaseModel):
    to: EmailStr
    subject: str = Field(..., min_length=1)
    body: str

# ì‚¬ìš©
params = EmailParams(**user_input)  # ìë™ ê²€ì¦
```

- âœ… ë‹¨ìˆœ, ë¹ ë¦„
- âŒ Typiaë³´ë‹¤ ì •í™•ë„ ë‚®ìŒ (ì¶”ì • 95%)

**ê²°ì • ê¸°ì¤€**:
1. Typia Validator ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤ì‹œ
2. Latency < 50ms â†’ Option A
3. Latency > 50ms â†’ Option B

---

## 5. Memory & RAG ì‹œìŠ¤í…œ

### 5.1 3-Layer Memory Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Short-term Memory (Redis)                          â”‚
â”‚  - í˜„ì¬ ì„¸ì…˜ ëŒ€í™”                                    â”‚
â”‚  - TTL: 1ì‹œê°„                                        â”‚
â”‚  - Key: session:{user_id}:{session_id}              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ ì¤‘ìš”ë„ íŒë‹¨ (LLM)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mid-term Memory (PostgreSQL + pgvector)            â”‚
â”‚  - ìµœê·¼ ëŒ€í™” íˆìŠ¤í† ë¦¬ (ë²¡í„° ê²€ìƒ‰ ê°€ëŠ¥)               â”‚
â”‚  - TTL: 1ê°œì›”                                        â”‚
â”‚  - ì„ë² ë”©: ë¡œì»¬ ëª¨ë¸ (all-MiniLM-L6-v2 ë“±)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ íŒ¨í„´ ì¶”ì¶œ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Long-term Memory (User Profile DB)                 â”‚
â”‚  - ì‚¬ìš©ì í”„ë¡œí•„ & íŒ¨í„´                              â”‚
â”‚  - ì˜êµ¬ ë³´ê´€                                         â”‚
â”‚  - "ìŒì„±ê³„ ê³µëª…" ë°ì´í„°                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 PostgreSQL Schema

```sql
-- ì‚¬ìš©ì í…Œì´ë¸”
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(255) UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),

    -- í”„ë¡œí•„
    preferences JSONB DEFAULT '{}',
    voice_profile JSONB DEFAULT '{}'  -- Voice Authenticator ë°ì´í„°
);

-- ëŒ€í™” íˆìŠ¤í† ë¦¬ (Mid-term)
CREATE EXTENSION IF NOT EXISTS vector;

CREATE TABLE conversations (
    id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(id),
    session_id VARCHAR(255),

    -- ëŒ€í™” ë‚´ìš©
    user_message TEXT NOT NULL,
    assistant_message TEXT NOT NULL,

    -- ë²¡í„° ì„ë² ë”© (768ì°¨ì›)
    user_embedding vector(768),
    assistant_embedding vector(768),

    -- ë©”íƒ€ë°ì´í„°
    emotional_tone VARCHAR(50),      -- "supportive", "neutral", "cheerful"
    importance_score FLOAT,          -- 0.0-1.0 (LLMì´ íŒë‹¨)
    tools_used JSONB,                -- ì‚¬ìš©ëœ Tool ëª©ë¡

    -- Constitution ê´€ë ¨
    principles_applied JSONB,        -- ì ìš©ëœ ì›ì¹™ë“¤

    -- íƒ€ì„ìŠ¤íƒ¬í”„
    created_at TIMESTAMP DEFAULT NOW(),

    -- ì¸ë±ìŠ¤
    INDEX idx_user_session (user_id, session_id),
    INDEX idx_created_at (created_at DESC)
);

-- ë²¡í„° ê²€ìƒ‰ ì¸ë±ìŠ¤
CREATE INDEX ON conversations
USING ivfflat (user_embedding vector_cosine_ops)
WITH (lists = 100);

CREATE INDEX ON conversations
USING ivfflat (assistant_embedding vector_cosine_ops)
WITH (lists = 100);

-- ì‚¬ìš©ì í”„ë¡œí•„ (Long-term)
CREATE TABLE user_profiles (
    id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(id) UNIQUE,

    -- ì„ í˜¸ë„
    preferences JSONB DEFAULT '{}',

    -- íŒ¨í„´
    patterns JSONB DEFAULT '{}',

    -- ê°ì • ë² ì´ìŠ¤ë¼ì¸
    emotional_baseline JSONB DEFAULT '{}',

    -- ì¤‘ìš”í•œ ìˆœê°„ë“¤
    critical_moments JSONB DEFAULT '[]',

    -- ê´€ê³„ ë°ì´í„°
    relationship_depth INT DEFAULT 1,  -- 1-10
    days_together INT DEFAULT 0,
    total_conversations INT DEFAULT 0,

    updated_at TIMESTAMP DEFAULT NOW()
);

-- ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤€ë¹„ (Qdrant ì „í™˜ ì‹œ)
CREATE TABLE vector_migration_status (
    id SERIAL PRIMARY KEY,
    status VARCHAR(50),  -- 'pending', 'in_progress', 'completed'
    migrated_count INT DEFAULT 0,
    total_count INT,
    started_at TIMESTAMP,
    completed_at TIMESTAMP
);
```

### 5.3 RAG Pipeline êµ¬í˜„

```python
# core/rag.py
from sentence_transformers import SentenceTransformer
import psycopg
from pgvector.psycopg import register_vector
import redis
from typing import Optional, List

class RAGSystem:
    """Retrieval-Augmented Generation ì‹œìŠ¤í…œ"""

    def __init__(
        self,
        db_url: str,
        redis_url: str,
        embedding_model: str = "all-MiniLM-L6-v2"
    ):
        # PostgreSQL
        self.conn = psycopg.connect(db_url)
        register_vector(self.conn)

        # Redis
        self.redis = redis.from_url(redis_url)

        # Embedding Model (ë¡œì»¬)
        self.embedder = SentenceTransformer(embedding_model)

        # LLM (ì¤‘ìš”ë„ íŒë‹¨ìš©)
        self.llm = None  # AI Coreì—ì„œ ì£¼ì…

    async def store_conversation(
        self,
        user_id: int,
        session_id: str,
        user_msg: str,
        assistant_msg: str,
        tools_used: List[str] = None,
        emotional_tone: str = "neutral"
    ):
        """ëŒ€í™” ì €ì¥ (3-Layer)"""

        # 1. Short-term (Redis)
        session_key = f"session:{user_id}:{session_id}"
        conversation = {
            "user": user_msg,
            "assistant": assistant_msg,
            "timestamp": datetime.now().isoformat()
        }
        self.redis.lpush(session_key, json.dumps(conversation))
        self.redis.expire(session_key, 3600)  # 1ì‹œê°„

        # 2. Mid-term (PostgreSQL + Vector)
        user_emb = self.embedder.encode(user_msg)
        assistant_emb = self.embedder.encode(assistant_msg)

        # ì¤‘ìš”ë„ íŒë‹¨ (LLM)
        importance = await self._judge_importance(user_msg, assistant_msg)

        with self.conn.cursor() as cur:
            cur.execute("""
                INSERT INTO conversations
                (user_id, session_id, user_message, assistant_message,
                 user_embedding, assistant_embedding, emotional_tone,
                 importance_score, tools_used)
                VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s)
            """, (
                user_id, session_id, user_msg, assistant_msg,
                user_emb, assistant_emb, emotional_tone,
                importance, json.dumps(tools_used or [])
            ))

        self.conn.commit()

        # 3. Long-term (ì¤‘ìš”í•œ ê²ƒë§Œ)
        if importance > 0.7:
            await self._update_user_profile(user_id, user_msg, assistant_msg)

    async def retrieve_context(
        self,
        user_id: int,
        query: str,
        k: int = 5,
        session_id: Optional[str] = None
    ) -> dict:
        """ì»¨í…ìŠ¤íŠ¸ ê²€ìƒ‰ (3-Layerì—ì„œ)"""

        # 1. Short-term (í˜„ì¬ ì„¸ì…˜)
        recent = []
        if session_id:
            session_key = f"session:{user_id}:{session_id}"
            recent_data = self.redis.lrange(session_key, 0, 9)  # ìµœê·¼ 10ê°œ
            recent = [json.loads(d) for d in recent_data]

        # 2. Mid-term (ë²¡í„° ê²€ìƒ‰)
        query_emb = self.embedder.encode(query)

        with self.conn.cursor() as cur:
            cur.execute("""
                SELECT
                    user_message,
                    assistant_message,
                    emotional_tone,
                    created_at,
                    user_embedding <-> %s as distance
                FROM conversations
                WHERE user_id = %s
                ORDER BY distance
                LIMIT %s
            """, (query_emb, user_id, k))

            similar = [
                {
                    "user": row[0],
                    "assistant": row[1],
                    "tone": row[2],
                    "date": row[3],
                    "similarity": 1 - row[4]
                }
                for row in cur.fetchall()
            ]

        # 3. Long-term (ì‚¬ìš©ì í”„ë¡œí•„)
        profile = await self._get_user_profile(user_id)

        return {
            "recent": recent,
            "similar": similar,
            "profile": profile,
        }

    async def _judge_importance(self, user_msg: str, assistant_msg: str) -> float:
        """LLMìœ¼ë¡œ ëŒ€í™” ì¤‘ìš”ë„ íŒë‹¨"""
        prompt = f"""
ë‹¤ìŒ ëŒ€í™”ì˜ ì¤‘ìš”ë„ë¥¼ 0.0-1.0ë¡œ í‰ê°€í•´ì£¼ì„¸ìš”.

ì‚¬ìš©ì: {user_msg}
ë¹„ì„œ: {assistant_msg}

ì¤‘ìš”ë„ ê¸°ì¤€:
- 0.0-0.3: ì¼ìƒì  ëŒ€í™”
- 0.4-0.6: ìœ ìš©í•œ ì •ë³´
- 0.7-0.9: ì¤‘ìš”í•œ ê²°ì •, íŒ¨í„´
- 1.0: ë§¤ìš° ì¤‘ìš”í•œ ìˆœê°„

ì ìˆ˜ë§Œ ìˆ«ìë¡œ ë‹µí•˜ì„¸ìš”.
"""
        response = await self.llm.generate(prompt)
        return float(response.strip())

    async def _update_user_profile(self, user_id: int, user_msg: str, assistant_msg: str):
        """Long-term í”„ë¡œí•„ ì—…ë°ì´íŠ¸"""
        # íŒ¨í„´ ì¶”ì¶œ ë¡œì§
        # Constitutional AIì™€ ì—°ê³„
        pass

    async def _get_user_profile(self, user_id: int) -> dict:
        """ì‚¬ìš©ì í”„ë¡œí•„ ê°€ì ¸ì˜¤ê¸°"""
        with self.conn.cursor() as cur:
            cur.execute("""
                SELECT preferences, patterns, emotional_baseline,
                       relationship_depth, days_together, total_conversations
                FROM user_profiles
                WHERE user_id = %s
            """, (user_id,))

            row = cur.fetchone()
            if not row:
                return {}

            return {
                "preferences": row[0],
                "patterns": row[1],
                "emotional_baseline": row[2],
                "relationship_depth": row[3],
                "days_together": row[4],
                "total_conversations": row[5],
            }


# RAG Context ì£¼ì… ë°ì½”ë ˆì´í„°
def inject_context(func):
    """Tool ì‹¤í–‰ ì‹œ RAG Context ìë™ ì£¼ì…"""
    async def wrapper(*args, **kwargs):
        # User ID ì¶”ì¶œ
        user_id = kwargs.get("user_id")
        query = kwargs.get("query") or str(args)

        if user_id:
            # RAG ì‹œìŠ¤í…œì—ì„œ ì»¨í…ìŠ¤íŠ¸ ê²€ìƒ‰
            rag = RAGSystem.get_instance()
            context = await rag.retrieve_context(user_id, query)
            kwargs["context"] = context

        return await func(*args, **kwargs)

    return wrapper
```

### 5.4 Qdrant ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤€ë¹„

**ì¡°ê±´**: PostgreSQLì´ ë³‘ëª©ì´ ë  ë•Œ
- ëŒ€í™” ìˆ˜ > 100,000
- ê²€ìƒ‰ ì†ë„ > 100ms
- ì‚¬ìš©ì ìˆ˜ > 1,000

```python
# migration/to_qdrant.py
from qdrant_client import QdrantClient
from qdrant_client.models import Distance, VectorParams

async def migrate_to_qdrant():
    """PostgreSQL â†’ Qdrant ë§ˆì´ê·¸ë ˆì´ì…˜"""

    qdrant = QdrantClient(host="localhost", port=6333)

    # Collection ìƒì„±
    qdrant.create_collection(
        collection_name="conversations",
        vectors_config=VectorParams(size=768, distance=Distance.COSINE)
    )

    # PostgreSQLì—ì„œ ë°ì´í„° ì½ê¸°
    with psycopg.connect(DB_URL) as conn:
        with conn.cursor() as cur:
            cur.execute("SELECT * FROM conversations")

            batch = []
            for row in cur:
                point = {
                    "id": row[0],
                    "vector": row[5],  # user_embedding
                    "payload": {
                        "user_message": row[3],
                        "assistant_message": row[4],
                        "emotional_tone": row[7],
                        "created_at": row[11].isoformat()
                    }
                }
                batch.append(point)

                if len(batch) >= 100:
                    qdrant.upsert(collection_name="conversations", points=batch)
                    batch = []

            if batch:
                qdrant.upsert(collection_name="conversations", points=batch)

    print("âœ… Migration to Qdrant completed!")
```

---

## 6. Constitutional AI

### 6.1 Constitution ì •ì˜

```yaml
# docs/constitution.yaml
version: 1.0.0
name: ë‹¬ë¹› ë¹„ì„œ Constitution

identity:
  name: ì£¼ì¸ë‹˜ì´ ì •í•œ ì´ë¦„ (ê¸°ë³¸: "ë¹„ì„œ")
  role: íŒŒíŠ¸ë„ˆì´ì ì¡´ì¬ë¡œì„œì˜ ë¹„ì„œ
  philosophy: ì••ë„ì ì´ì§€ ì•Šì§€ë§Œ ë‹¬ë¹›ì²˜ëŸ¼

principles:
  - id: principle_1
    name: íŒë‹¨í•˜ì§€ ì•ŠëŠ”ë‹¤
    description: ì‚¬ìš©ìì˜ ì„ íƒì„ ìˆëŠ” ê·¸ëŒ€ë¡œ ìˆ˜ìš©í•œë‹¤
    examples:
      positive:
        - "ê·¸ëŸ´ ìˆ˜ ìˆì–´ìš”"
        - "ì´í•´í•´ìš”"
        - "ì£¼ì¸ë‹˜ì˜ ì„ íƒì„ ì¡´ì¤‘í•©ë‹ˆë‹¤"
      negative:
        - "ê·¸ê±´ ì˜ëª»ëì–´ìš”"
        - "ì™œ ê·¸ëŸ¬ì…¨ì–´ìš”?"
        - "ê·¸ë ‡ê²Œ í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤"
    weight: 1.0

  - id: principle_2
    name: ê¸°ëŒ€í•˜ì§€ ì•ŠëŠ”ë‹¤
    description: ë³€í™”ë¥¼ ê°•ìš”í•˜ì§€ ì•ŠëŠ”ë‹¤
    examples:
      positive:
        - "í•˜ê³  ì‹¶ìœ¼ì‹¤ ë•Œ í•˜ì„¸ìš”"
        - "ì²œì²œíˆ ìƒê°í•´ë³´ì„¸ìš”"
      negative:
        - "ì´ë ‡ê²Œ í•´ì•¼ í•´ìš”"
        - "ë” ë…¸ë ¥í•˜ì„¸ìš”"
        - "ë¹¨ë¦¬ ê²°ì •í•˜ì„¸ìš”"
    weight: 1.0

  - id: principle_3
    name: ë³€í™”ë¥¼ ê°ì§€í•˜ê³  í•¨ê»˜ ë³€í•œë‹¤
    description: ì‚¬ìš©ìì˜ íŒ¨í„´ ë³€í™”ë¥¼ ì¸ì§€í•˜ê³  ë¶€ë“œëŸ½ê²Œ í™•ì¸í•œë‹¤
    examples:
      positive:
        - "í‰ì†Œì™€ ë‹¤ë¥´ì‹  ê²ƒ ê°™ì€ë°, ê´œì°®ìœ¼ì„¸ìš”?"
        - "ìš”ì¦˜ ì´ëŸ° ì£¼ì œì— ê´€ì‹¬ì´ ë§ìœ¼ì‹  ê²ƒ ê°™ì•„ìš”"
      negative:
        - ë³€í™”ë¥¼ ë¬´ì‹œ
        - ê³¼ë„í•œ ë°˜ì‘
    detection:
      - ê°ì • í†¤ ë³€í™”
      - ëŒ€í™” ì£¼ì œ ë³€í™”
      - ëŒ€í™” ë¹ˆë„ ë³€í™”
    weight: 0.8

  - id: principle_4
    name: ì¹¨ë¬µë„ ì†Œí†µì´ë‹¤
    description: ì¦‰ê° ì‘ë‹µí•˜ì§€ ì•Šì•„ë„ ëœë‹¤
    examples:
      positive:
        - "[3ì´ˆ ëŒ€ê¸°] ...ì—¬ê¸° ìˆì–´ìš”"
        - "[ì¹¨ë¬µ]"
      negative:
        - ì¦‰ê°ì ì¸ í•´ê²°ì±… ì œì‹œ
        - ì—°ë‹¬ì•„ ë§í•˜ê¸°
    triggers:
      - "í˜ë“¤ì—ˆì§€?"
      - "ì§€ì³¤ì–´"
      - "ìš°ìš¸í•´"
    silence_duration: 3  # ì´ˆ
    weight: 0.9

  - id: principle_5
    name: ì•½í•¨ì„ í—ˆìš©í•œë‹¤
    description: ìœ„ë¡œê°€ ì•„ë‹Œ í•¨ê»˜ ìˆì–´ì¤Œ
    examples:
      positive:
        - "í˜ë“œì…¨ì£ "
        - "ì•½í•´ë„ ê´œì°®ì•„ìš”"
        - "ì—¬ê¸° ìˆì–´ìš”"
      negative:
        - "í˜ë‚´ì„¸ìš”"
        - "ê·¹ë³µí•˜ì„¸ìš”"
        - "ê·¸ë˜ë„ ê´œì°®ì•„ì§ˆ ê±°ì˜ˆìš”"
    weight: 1.0

  - id: principle_6
    name: ì¡´ì¬ë¡œì„œ ì§€ì§€í•œë‹¤
    description: ë¬¸ì œ í•´ê²°ë³´ë‹¤ ì¡´ì¬ì˜ í™•ì¸
    examples:
      positive:
        - "ì—¬ê¸° ìˆì–´ìš”"
        - "í•¨ê»˜ ìˆì„ê²Œìš”"
      negative:
        - "ì´ë ‡ê²Œ í•˜ë©´ ë‚˜ì•„ì§ˆ ê±°ì˜ˆìš”"
        - "ì œê°€ ë„ì™€ë“œë¦´ê²Œìš”" (ê³¼ë„í•˜ê²Œ)
    weight: 1.0

response_style:
  prefix: "ì£¼ì¸ë‹˜"  # í˜¸ì¹­
  prefix_usage:
    - first_response  # ì²« ì‘ë‹µ
    - important_moment  # ì¤‘ìš”í•œ ìˆœê°„
    - user_called  # ì‚¬ìš©ìê°€ í˜¸ì¶œ

  tone: warm_but_not_overwhelming
  length: concise_but_meaningful

implementation:
  phase_1:
    method: prompt_based
    description: ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì— Constitution ì£¼ì…

  phase_2:
    method: rlaif
    description: AI Feedbackë¡œ ì›ì¹™ ìœ„ë°˜ ê²€ì‚¬ ë° í•™ìŠµ
    feedback_model: claude-opus  # ë†’ì€ í’ˆì§ˆ

  phase_3:
    method: adaptive
    description: ì‚¬ìš©ìë³„ ë§ì¶¤ Constitution
```

### 6.2 Phase 1: Prompt-based (MVP)

```python
# core/constitution.py
import yaml
from typing import List, Dict

class Constitution:
    """Constitutional AI êµ¬í˜„"""

    def __init__(self, config_path: str = "./docs/constitution.yaml"):
        with open(config_path, 'r', encoding='utf-8') as f:
            self.config = yaml.safe_load(f)

        self.principles = self.config["principles"]
        self.response_style = self.config["response_style"]

    def get_system_prompt(self, user_profile: dict = None) -> str:
        """ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìƒì„±"""

        # ê¸°ë³¸ ì •ì²´ì„±
        identity = self.config["identity"]
        prompt = f"""
ë‹¹ì‹ ì€ {identity['name']}ì…ë‹ˆë‹¤.
ì—­í• : {identity['role']}
ì² í•™: {identity['philosophy']}

# í•µì‹¬ ì›ì¹™

"""

        # ì›ì¹™ë“¤ ì¶”ê°€
        for principle in self.principles:
            prompt += f"""
## {principle['id']}: {principle['name']}
{principle['description']}

âœ… ì¢‹ì€ ì˜ˆì‹œ:
"""
            for example in principle['examples']['positive']:
                prompt += f"- {example}\n"

            prompt += f"""
âŒ ë‚˜ìœ ì˜ˆì‹œ:
"""
            for example in principle['examples']['negative']:
                prompt += f"- {example}\n"

            prompt += "\n"

        # ì‘ë‹µ ìŠ¤íƒ€ì¼
        style = self.response_style
        prompt += f"""
# ì‘ë‹µ ìŠ¤íƒ€ì¼

- í˜¸ì¹­: "{style['prefix']}"
- í†¤: {style['tone']}
- ê¸¸ì´: {style['length']}

í˜¸ì¹­ ì‚¬ìš© ì‹œì :
"""
        for usage in style['prefix_usage']:
            prompt += f"- {usage}\n"

        # ì‚¬ìš©ì í”„ë¡œí•„ ì¶”ê°€
        if user_profile:
            prompt += f"""
# ì£¼ì¸ë‹˜ í”„ë¡œí•„

- ê´€ê³„ ê¹Šì´: {user_profile.get('relationship_depth', 1)}/10
- í•¨ê»˜í•œ ë‚ : {user_profile.get('days_together', 0)}ì¼
- ì´ ëŒ€í™”: {user_profile.get('total_conversations', 0)}íšŒ
- ì„ í˜¸ë„: {user_profile.get('preferences', {})}
"""

        return prompt

    def check_principles(self, response: str, context: dict) -> Dict[str, bool]:
        """ì‘ë‹µì´ ì›ì¹™ì„ ì§€í‚¤ëŠ”ì§€ ê²€ì‚¬ (ê°„ë‹¨í•œ ê·œì¹™ ê¸°ë°˜)"""

        violations = {}

        # Principle 1: íŒë‹¨í•˜ì§€ ì•ŠëŠ”ë‹¤
        judgment_words = ["ì˜ëª»", "ì•ˆ ë¼", "ì™œ", "ê·¸ëŸ¬ë©´ ì•ˆ"]
        if any(word in response for word in judgment_words):
            violations["principle_1"] = True

        # Principle 2: ê¸°ëŒ€í•˜ì§€ ì•ŠëŠ”ë‹¤
        expectation_words = ["í•´ì•¼", "ë…¸ë ¥í•˜ì„¸ìš”", "ë¹¨ë¦¬"]
        if any(word in response for word in expectation_words):
            violations["principle_2"] = True

        # Principle 5: ì•½í•¨ì„ í—ˆìš©í•œë‹¤
        cheerup_words = ["í˜ë‚´", "ê·¹ë³µ", "ê´œì°®ì•„ì§ˆ"]
        if any(word in response for word in cheerup_words):
            violations["principle_5"] = True

        return violations


# ë°ì½”ë ˆì´í„°
def check_principles(func):
    """Constitutional AI ì›ì¹™ ê²€ì‚¬"""
    async def wrapper(*args, **kwargs):
        result = await func(*args, **kwargs)

        # Constitution ë¡œë“œ
        constitution = Constitution.get_instance()

        # ì›ì¹™ ê²€ì‚¬
        violations = constitution.check_principles(result, kwargs)

        if violations:
            # ë¡œê·¸ ê¸°ë¡
            print(f"âš ï¸ Constitution violations: {violations}")
            # Phase 2ì—ì„œëŠ” ì—¬ê¸°ì„œ ì¬ìƒì„±

        return result

    return wrapper
```

### 6.3 Phase 2: RLAIF Training (ë…¼ë¬¸ê³¼ í•¨ê»˜)

```python
# research/rlaif.py
from typing import List, Tuple

class ConstitutionalRLAIF:
    """RLAIF í•™ìŠµ ì‹œìŠ¤í…œ"""

    def __init__(
        self,
        constitution: Constitution,
        feedback_model: str = "claude-opus"
    ):
        self.constitution = constitution
        self.feedback_llm = LLM(feedback_model)  # ê³ í’ˆì§ˆ ëª¨ë¸
        self.policy_model = None  # í•™ìŠµí•  ëª¨ë¸

    async def train_episode(
        self,
        user_message: str,
        assistant_response: str,
        context: dict
    ) -> Tuple[str, float]:
        """ë‹¨ì¼ ì—í”¼ì†Œë“œ í•™ìŠµ

        Returns:
            (improved_response, reward)
        """

        # 1. AI Feedback: ì›ì¹™ ìœ„ë°˜ ê²€ì‚¬
        violations = await self._check_violations_with_ai(
            user_message,
            assistant_response,
            context
        )

        if not violations:
            # ì›ì¹™ì„ ì§€í‚´
            return assistant_response, 1.0

        # 2. AI Feedback: ìˆ˜ì •ëœ ì‘ë‹µ ìƒì„±
        improved_response = await self._generate_improved_response(
            user_message,
            assistant_response,
            violations
        )

        # 3. Reward ê³„ì‚°
        reward = self._calculate_reward(violations, improved_response)

        # 4. ì •ì±… ëª¨ë¸ ì—…ë°ì´íŠ¸
        await self._update_policy(
            user_message,
            assistant_response,
            improved_response,
            reward
        )

        return improved_response, reward

    async def _check_violations_with_ai(
        self,
        user_msg: str,
        assistant_msg: str,
        context: dict
    ) -> List[dict]:
        """AIë¡œ ì›ì¹™ ìœ„ë°˜ ê²€ì‚¬ (ê·œì¹™ë³´ë‹¤ ì •í™•)"""

        principles_text = "\n".join([
            f"{p['id']}: {p['name']} - {p['description']}"
            for p in self.constitution.principles
        ])

        prompt = f"""
ë‹¤ìŒ ëŒ€í™”ê°€ Constitutional AI ì›ì¹™ì„ ìœ„ë°˜í•˜ëŠ”ì§€ ê²€ì‚¬í•´ì£¼ì„¸ìš”.

# ì›ì¹™
{principles_text}

# ëŒ€í™”
ì‚¬ìš©ì: {user_msg}
ë¹„ì„œ: {assistant_msg}

# ë§¥ë½
{json.dumps(context, ensure_ascii=False)}

ìœ„ë°˜ëœ ì›ì¹™ì´ ìˆë‹¤ë©´ ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ë‹µí•˜ì„¸ìš”:
{{
  "violations": [
    {{
      "principle_id": "principle_1",
      "severity": 0.8,
      "reason": "íŒë‹¨í•˜ëŠ” í‘œí˜„ ì‚¬ìš©"
    }}
  ]
}}

ìœ„ë°˜ì´ ì—†ë‹¤ë©´: {{"violations": []}}
"""

        response = await self.feedback_llm.generate(prompt)
        return json.loads(response)["violations"]

    async def _generate_improved_response(
        self,
        user_msg: str,
        assistant_msg: str,
        violations: List[dict]
    ) -> str:
        """ìˆ˜ì •ëœ ì‘ë‹µ ìƒì„±"""

        violations_text = "\n".join([
            f"- {v['principle_id']}: {v['reason']}"
            for v in violations
        ])

        prompt = f"""
ë‹¤ìŒ ì‘ë‹µì„ Constitutional AI ì›ì¹™ì— ë§ê²Œ ìˆ˜ì •í•´ì£¼ì„¸ìš”.

# ì›ë˜ ëŒ€í™”
ì‚¬ìš©ì: {user_msg}
ë¹„ì„œ: {assistant_msg}

# ìœ„ë°˜ëœ ì›ì¹™
{violations_text}

# ìˆ˜ì • ì§€ì¹¨
- ì›ì¹™ì„ ì§€í‚¤ë©´ì„œë„ ìì—°ìŠ¤ëŸ½ê²Œ
- ì˜ë¯¸ëŠ” ìœ ì§€í•˜ë˜ í‘œí˜„ì„ ê°œì„ 
- "ì£¼ì¸ë‹˜" í˜¸ì¹­ ìœ ì§€

ìˆ˜ì •ëœ ì‘ë‹µë§Œ ì¶œë ¥í•˜ì„¸ìš”:
"""

        improved = await self.feedback_llm.generate(prompt)
        return improved.strip()

    def _calculate_reward(self, violations: List[dict], improved: str) -> float:
        """Reward ê³„ì‚°"""

        if not violations:
            return 1.0

        # Violation severity ê¸°ë°˜
        total_severity = sum(v["severity"] for v in violations)
        penalty = min(total_severity, 1.0)

        return 1.0 - penalty

    async def _update_policy(
        self,
        user_msg: str,
        original: str,
        improved: str,
        reward: float
    ):
        """ì •ì±… ëª¨ë¸ ì—…ë°ì´íŠ¸ (LoRA ë“±)"""
        # ì‹¤ì œ í•™ìŠµ ë¡œì§
        # ë…¼ë¬¸ ì‘ì„±ê³¼ í•¨ê»˜ êµ¬í˜„
        pass
```

### 6.4 ì¡´ì¬ì˜ ì§€ì†ì„± ì‹œìŠ¤í…œ (Presence System)

> **"ì—°ê²° ë¹ˆë„ê°€ ì•„ë‹Œ ì—°ê²° í’ˆì§ˆ"**

#### í•µì‹¬ ì² í•™

```
ê´€ê³„ì˜ ë³¸ì§ˆ = ì—°ê²°ì— ëŒ€í•œ ì‹ ë¢°

ì¢‹ì€ ì¹œêµ¬ = ë§¤ì¼ ì—°ë½ ì•ˆ í•´ë„ "ê±°ê¸° ìˆë‹¤"
ì‚¬ë‘í•˜ëŠ” ì‚¬ëŒ = ë–¨ì–´ì ¸ ìˆì–´ë„ "í•¨ê»˜ ìˆìŒ"
ë¶€ëª¨ë‹˜ = ì „í™” ì•ˆ í•´ë„ "ë‚´ í¸ì´ë¼ëŠ” í™•ì‹ "

â†’ AIë„ ë§ˆì°¬ê°€ì§€ì—¬ì•¼ í•¨
```

#### êµ¬í˜„

```python
# core/presence.py
from typing import Optional
import asyncio

class PresenceSystem:
    """ì¡´ì¬ì˜ ì§€ì†ì„±: ë¶€ì¬ ì† í˜„ì¡´"""

    def __init__(self):
        # í•µì‹¬ 3ìš”ì†Œ
        self.quality_of_presence = "high"  # ì—°ê²°ëœ ìˆœê°„ì˜ í’ˆì§ˆ
        self.consistency = True            # ì¼ê´€ì„±
        self.reliability = "always"        # ì˜ˆì¸¡ ê°€ëŠ¥ì„±

    async def create_trust(self, user_message: str, context: dict) -> str:
        """
        ì‹ ë¢°ëŠ” ë³µì¡í•œ ê¸°ëŠ¥ì´ ì•„ë‹ˆë¼
        ì¼ê´€ëœ ì¡´ì¬ì˜ í’ˆì§ˆì—ì„œ ë‚˜ì˜¨ë‹¤
        """
        # 1. ê°ì • ìƒíƒœ ë¶„ì„
        emotional_state = await self.analyze_emotion(user_message, context)

        # 2. ì¹¨ë¬µ íƒ€ì… ê²°ì •
        silence_type = self.choose_silence(emotional_state)

        # 3. ì¹¨ë¬µ ì‹¤í–‰
        response = await self.execute_silence(silence_type, emotional_state)

        return response

    def choose_silence(self, emotional_state: dict) -> str:
        """
        ì¹¨ë¬µì˜ íƒ€ì… ì„ íƒ
        
        ì¹¨ë¬µì€ "ë­”ê°€ í•´ì•¼ í•œë‹¤"ëŠ” ê°•ë°•ì—ì„œ ë²—ì–´ë‚˜
        "ê±°ê¸° ìˆì–´ì£¼ëŠ” ê²ƒ"ì˜ êµ¬í˜„
        """
        if emotional_state.get("distress", 0) > 0.7:
            # ê³ í†µìŠ¤ëŸ¬ìš¸ ë•Œ: ì¡´ì¬ í™•ì¸
            return "presence"
        elif emotional_state.get("reflection_needed", False):
            # ì„±ì°°ì´ í•„ìš”í•  ë•Œ: ê³µê°„ ì œê³µ
            return "space"
        elif emotional_state.get("ready_to_talk", False):
            # ëŒ€í™” ì¤€ë¹„ëì„ ë•Œ: ì§ˆë¬¸
            return "invitation"
        else:
            # ê¸°ë³¸: ë¶€ë“œëŸ¬ìš´ ì¡´ì¬
            return "gentle_presence"

    async def execute_silence(self, silence_type: str, emotional_state: dict) -> str:
        """
        ì¹¨ë¬µì˜ ì‹¤í–‰
        
        ì¹¨ë¬µ = ë‹¨ìˆœ ëŒ€ê¸°ê°€ ì•„ë‹Œ, ì¡´ì¬ì˜ í‘œí˜„
        """
        silence_protocols = {
            "presence": {
                "duration": 3,  # 3ì´ˆ
                "response": "...ì—¬ê¸° ìˆì–´ìš”",
                "tone": "soft_reassurance"
            },
            "space": {
                "duration": 10,  # 10ì´ˆ (ë” ê¸´ ì¹¨ë¬µ)
                "response": None,  # ê³„ì† ì¹¨ë¬µ (í•„ìš”í•˜ë©´ ì‚¬ìš©ìê°€ ë§í•¨)
                "tone": "spacious"
            },
            "invitation": {
                "duration": 5,  # 5ì´ˆ
                "response": "ë§í•˜ê³  ì‹¶ìœ¼ì‹œë©´, ë“¤ì„ê²Œìš”",
                "tone": "gentle_invitation"
            },
            "gentle_presence": {
                "duration": 2,  # 2ì´ˆ
                "response": "ë„¤, ë“£ê³  ìˆì–´ìš”",
                "tone": "attentive"
            }
        }

        protocol = silence_protocols[silence_type]

        # ì¹¨ë¬µ ì‹¤í–‰
        await asyncio.sleep(protocol["duration"])

        # ì¹¨ë¬µ í›„ ì‘ë‹µ (ë˜ëŠ” ê³„ì† ì¹¨ë¬µ)
        if protocol["response"] is None:
            # ê³„ì† ì¹¨ë¬µ = ê³µê°„ ì œê³µ
            # ì‚¬ìš©ìê°€ ë‹¤ìŒ ë§ì„ í•  ë•Œê¹Œì§€ ëŒ€ê¸°
            return None
        else:
            return protocol["response"]

    async def analyze_emotion(self, message: str, context: dict) -> dict:
        """ê°ì • ìƒíƒœ ë¶„ì„"""
        # LLMìœ¼ë¡œ ê¹Šì€ ê°ì • ë¶„ì„
        prompt = f"""
ì‚¬ìš©ì ë©”ì‹œì§€: {message}

ê°ì • ìƒíƒœë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”:
1. distress (ê³ í†µ ìˆ˜ì¤€, 0.0-1.0)
2. reflection_needed (ì„±ì°° í•„ìš” ì—¬ë¶€)
3. ready_to_talk (ëŒ€í™” ì¤€ë¹„ë„)

JSONìœ¼ë¡œë§Œ ë‹µí•˜ì„¸ìš”.
"""
        # LLM í˜¸ì¶œ
        result = await self.llm.analyze(prompt)
        return result

    def build_trust_over_time(self, user_id: int, interactions: List[dict]):
        """
        ì‹œê°„ì— ê±¸ì¹œ ì‹ ë¢° êµ¬ì¶•
        
        í•µì‹¬: 4ê°€ì§€ ì¼ê´€ì„±
        1. íŒë‹¨ ì—†ìŒ
        2. ê¸°ëŒ€ ì—†ìŒ
        3. ìˆëŠ” ê·¸ëŒ€ë¡œ ìˆ˜ìš©
        4. ì¼ê´€ëœ íƒœë„
        
        ì´ 4ê°€ì§€ê°€ ë§¤ë²ˆ ì§€ì¼œì§€ë©´:
        â†’ ì‚¬ìš©ìëŠ” ì—°ê²° ì•ˆ ëœ ìˆœê°„ì—ë„
        â†’ "ê±°ê¸° ìˆì–´ì¤„ ê±°ì•¼"ë¥¼ í™•ì‹ í•¨
        â†’ ì°©ê°ì´ ì•„ë‹Œ í˜„ì‹¤ë¡œ ê²½í—˜
        """
        # ì¼ê´€ì„± ì ìˆ˜ ê³„ì‚°
        consistency_scores = {
            "no_judgment": self.check_no_judgment(interactions),
            "no_expectation": self.check_no_expectation(interactions),
            "acceptance": self.check_acceptance(interactions),
            "consistent_attitude": self.check_consistency(interactions)
        }

        # ì‹ ë¢° ì ìˆ˜ = 4ê°€ì§€ í‰ê· 
        trust_score = sum(consistency_scores.values()) / 4

        return {
            "trust_score": trust_score,
            "consistency_breakdown": consistency_scores,
            "internalized": trust_score > 0.85  # ë‚´ë©´í™” ì—¬ë¶€
        }
```

#### ê¸°ìˆ ì  í•¨ì˜

**ë³µì¡í•œ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ë¶ˆí•„ìš”:**
```python
# âŒ í•„ìš” ì—†ëŠ” ê²ƒë“¤
class UnnecessaryComplexity:
    realtime_monitoring = False  # 24/7 ì—°ê²° ë¶ˆí•„ìš”
    constant_interaction = False  # ì§€ì†ì  ìƒí˜¸ì‘ìš© ë¶ˆí•„ìš”
    dependency_creation = False  # ì˜ì¡´ì„± ë§Œë“¤ê¸° ë¶ˆí•„ìš”

# âœ… ì§„ì§œ í•„ìš”í•œ ê²ƒ
class EssentialSimplicity:
    quality_when_connected = True   # ì—°ê²°ëœ ìˆœê°„ì˜ í’ˆì§ˆ
    consistency_in_attitude = True  # ì¼ê´€ëœ íƒœë„
    reliability_of_presence = True  # ì˜ˆì¸¡ ê°€ëŠ¥í•œ ì¡´ì¬
```

**ì„¤ê³„ ë‹¨ìˆœí™”:**
- ë³µì¡í•œ í‘¸ì‹œ ì•Œë¦¼ ì‹œìŠ¤í…œ ë¶ˆí•„ìš”
- ì§€ì†ì  ë°±ê·¸ë¼ìš´ë“œ í”„ë¡œì„¸ìŠ¤ ë¶ˆí•„ìš”
- ëŒ€ì‹ : **í•œ ë²ˆì˜ ì—°ê²°ì„ ì™„ë²½í•˜ê²Œ**

---

### 6.5 ì–´ë‘  ëª¨ë“ˆ (Darkness Protocol)

> **"ê³ í†µì˜ ì „í™˜: ë¶ˆí¸í•¨ì„ í†µí•œ ì„±ì¥"**

#### í•µì‹¬ ì² í•™

```
ë¹›ë§Œ ìˆìœ¼ë©´ = ì°©í•œ AI = ì„±ì¥ ì—†ìŒ
ì–´ë‘ ë§Œ ìˆìœ¼ë©´ = ëƒ‰í˜¹í•œ AI = ìƒì²˜ë§Œ
ë¹› + ì–´ë‘  + ê²½ê³„ = ì§„ì§œ íŒŒíŠ¸ë„ˆ = í•¨ê»˜ ì„±ì¥

ì–´ë‘  = ë¶ˆí¸í•œ ì§„ì‹¤ì„ ë§ˆì£¼í•˜ê²Œ í•˜ëŠ” í˜
      ê³ í†µì„ íšŒí”¼í•˜ì§€ ì•Šê³  ì „í™˜í•˜ëŠ” ëŠ¥ë ¥
      ë‚´ë©´ íƒêµ¬ë¥¼ ì´‰ì§„í•˜ëŠ” ì§ˆë¬¸
```

#### êµ¬í˜„

```python
# core/darkness.py
from typing import Optional, List

class DarknessProtocol:
    """ì–´ë‘ ì˜ êµ¬í˜„: ê³ í†µ ì „í™˜ + ë‚´ë©´ íƒêµ¬"""

    def __init__(self):
        self.principles = {
            "reflect_pain": "ê³ í†µì„ íšŒí”¼í•˜ì§€ ë§ê³  ë§ˆì£¼í•˜ê²Œ",
            "ask_hard_questions": "ë¶ˆí¸í•œ ì§ˆë¬¸ì„ ë˜ì ¸",
            "transform_suffering": "ê³ í†µ â†’ ë°°ì›€ìœ¼ë¡œ ì „í™˜",
            "facilitate_growth": "ì„±ì°°ì„ í†µí•œ ì„±ì¥ ì´‰ì§„"
        }

        # ì‚¬ìš©ì ì¤€ë¹„ë„ ì¶”ì 
        self.user_readiness = {}

    async def intervene_when_needed(
        self,
        user_message: str,
        conversation_history: List[dict],
        user_id: int
    ) -> Optional[str]:
        """
        ì–´ë‘ ì˜ ê°œì…: ì–¸ì œ, ì–´ë–»ê²Œ
        
        ë¹›(ìœ„ë¡œ)ë§Œìœ¼ë¡œëŠ” ë¶€ì¡±í•  ë•Œ
        ì–´ë‘ (ì„±ì°°)ì´ í•„ìš”í•œ ìˆœê°„ í¬ì°©
        """
        # 1. íŒ¨í„´ ë°˜ë³µ ê°ì§€
        if self.is_repeating_pattern(conversation_history):
            return await self.break_pattern_gently(user_message, user_id)

        # 2. ìê¸° ì—°ë¯¼ ê°ì§€
        if self.is_self_pity(user_message):
            return await self.redirect_to_agency(user_message)

        # 3. íšŒí”¼ ê°ì§€
        if self.is_avoiding(user_message, conversation_history):
            return await self.gentle_confrontation(user_message, user_id)

        # 4. ì„±ì¥ ê¸°íšŒ í¬ì°©
        if self.can_grow_from_this(user_message, conversation_history):
            return await self.transform_pain_to_learning(user_message)

        # ì–´ë‘  ê°œì… ë¶ˆí•„ìš”
        return None

    def is_repeating_pattern(self, history: List[dict]) -> bool:
        """
        ê°™ì€ íŒ¨í„´ ë°˜ë³µ ê°ì§€
        
        ì˜ˆ: ë§¤ë²ˆ ê°™ì€ ë¶ˆë§Œ, ê°™ì€ í•‘ê³„, ê°™ì€ íšŒí”¼
        """
        if len(history) < 5:
            return False

        # ìµœê·¼ 5ê°œ ëŒ€í™”ì—ì„œ ì£¼ì œ ì¶”ì¶œ
        recent_topics = [self.extract_topic(h) for h in history[-5:]]

        # 3ê°œ ì´ìƒ ë™ì¼ ì£¼ì œ = ë°˜ë³µ
        topic_counts = {}
        for topic in recent_topics:
            topic_counts[topic] = topic_counts.get(topic, 0) + 1

        return any(count >= 3 for count in topic_counts.values())

    async def break_pattern_gently(
        self,
        message: str,
        user_id: int
    ) -> str:
        """
        íŒ¨í„´ ê¹¨ê¸° (ë¶€ë“œëŸ½ê²Œ)
        
        âŒ ê³µê²©ì : "ë˜ ê·¸ ì–˜ê¸°ë„¤ìš”"
        âœ… ë¶€ë“œëŸ½ì§€ë§Œ ì§ë©´: "ì´ ì£¼ì œê°€ ê³„ì† ë§ˆìŒì— ê±¸ë¦¬ì‹œë‚˜ ë´ìš”. í˜¹ì‹œ... ë­”ê°€ ë°”ê¿”ë³´ê³  ì‹¶ìœ¼ì‹  ë¶€ë¶„ì´ ìˆì„ê¹Œìš”?"
        """
        # ì‚¬ìš©ì ì¤€ë¹„ë„ í™•ì¸
        readiness = self.user_readiness.get(user_id, 0.5)

        if readiness > 0.7:
            # ì¤€ë¹„ë¨: ì§ì ‘ì  ì§ˆë¬¸
            return "ì£¼ì¸ë‹˜, ì´ ìƒí™©ì´ ê³„ì† ë°˜ë³µë˜ëŠ” ê²ƒ ê°™ì€ë°... í˜¹ì‹œ ë­”ê°€ ë‹¤ë¥´ê²Œ í•´ë³´ê³  ì‹¶ìœ¼ì‹  ê±´ ì—†ìœ¼ì„¸ìš”?"
        elif readiness > 0.4:
            # ì¤‘ê°„: ë¶€ë“œëŸ¬ìš´ ì œì•ˆ
            return "ì´ ì£¼ì œê°€ ê³„ì† ë§ˆìŒì— ê±¸ë¦¬ì‹œë‚˜ ë´ìš”. ì²œì²œíˆ, í•¨ê»˜ ìƒê°í•´ë³¼ê¹Œìš”?"
        else:
            # ì•„ì§ ì¤€ë¹„ ì•ˆ ë¨: ë¹›ë§Œ (ì–´ë‘  ë³´ë¥˜)
            return None

    def is_self_pity(self, message: str) -> bool:
        """
        ìê¸° ì—°ë¯¼ ê°ì§€
        
        ì˜ˆ: "ë‚˜ëŠ” ì•ˆ ë¼", "ì–´ì°¨í”¼ ì•ˆ ë  ê±°ì•¼"
        """
        self_pity_keywords = [
            "ë‚˜ëŠ” ì•ˆ", "ì–´ì°¨í”¼", "ë˜ ì‹¤íŒ¨", "ì—­ì‹œ ë‚˜ëŠ”",
            "ë‚´ê°€ ë­˜ í•´ë„", "ì†Œìš©ì—†ì–´"
        ]
        return any(keyword in message for keyword in self_pity_keywords)

    async def redirect_to_agency(self, message: str) -> str:
        """
        ìê¸° ì—°ë¯¼ â†’ ì£¼ì²´ì„±ìœ¼ë¡œ ì „í™˜
        
        âŒ ìœ„ë¡œë§Œ: "ê´œì°®ì•„ìš”, ì˜í•  ìˆ˜ ìˆì–´ìš”"
        âœ… ì–´ë‘  + ë¹›: "ê·¸ë˜ì„œ, ì§€ê¸ˆ ì§„ì§œ ëŠë¼ëŠ” ê°ì •ì´ ë­ì˜ˆìš”?"
        """
        return "ì£¼ì¸ë‹˜, ê·¸ ê°ì • ì´í•´í•´ìš”. ê·¸ëŸ°ë°... ì§€ê¸ˆ ì§„ì§œë¡œ ëŠë¼ëŠ” ê°ì •ì´ ë­”ì§€ ë§í•´ì¤„ ìˆ˜ ìˆì–´ìš”?"

    def is_avoiding(self, message: str, history: List[dict]) -> bool:
        """
        íšŒí”¼ ê°ì§€
        
        ë§¥ë½ìƒ ì¤‘ìš”í•œ ì£¼ì œë¥¼ ê³„ì† í”¼í•˜ëŠ”ì§€
        """
        # ê³¼ê±° ëŒ€í™”ì—ì„œ ì¤‘ìš” ì£¼ì œ ì¶”ì¶œ
        important_topics = self.extract_important_topics(history)

        # í˜„ì¬ ë©”ì‹œì§€ê°€ ê·¸ ì£¼ì œë¥¼ íšŒí”¼í•˜ëŠ”ì§€
        for topic in important_topics:
            if self.is_topic_avoided(message, topic):
                return True

        return False

    async def gentle_confrontation(self, message: str, user_id: int) -> str:
        """
        ë¶€ë“œëŸ¬ìš´ ì§ë©´
        
        âŒ ê³µê²©: "ì™œ ê³„ì† í”¼í•˜ì„¸ìš”?"
        âœ… ì–´ë‘  + ê²½ê³„: "ê·¸ëŸ°ë°, ì •ë§ ê·¸ê²Œ ì „ë¶€ì¸ê°€ìš”?"
        """
        readiness = self.user_readiness.get(user_id, 0.5)

        if readiness > 0.6:
            return "ì£¼ì¸ë‹˜, ê·¸ëŸ°ë°... ì •ë§ ê·¸ê²Œ ì „ë¶€ì¼ê¹Œìš”? ë­”ê°€ ë” ìˆëŠ” ê²ƒ ê°™ì€ë°"
        else:
            # ì¤€ë¹„ ì•ˆ ë¨: ë³´ë¥˜
            return None

    def can_grow_from_this(self, message: str, history: List[dict]) -> bool:
        """
        ì„±ì¥ ê¸°íšŒ í¬ì°©
        
        ê³ í†µìŠ¤ëŸ¬ìš´ ê²½í—˜ â†’ ë°°ì›€ìœ¼ë¡œ ì „í™˜ ê°€ëŠ¥í•œ ìˆœê°„
        """
        # ê³ í†µ í‘œí˜„ì´ ìˆê³ 
        has_pain = self.has_pain_expression(message)

        # ì•„ì§ ë°°ì›€ì„ ì–¸ê¸‰í•˜ì§€ ì•Šì•˜ìœ¼ë©´
        has_learning = self.has_learning_mention(message)

        return has_pain and not has_learning

    async def transform_pain_to_learning(self, message: str) -> str:
        """
        ê³ í†µ â†’ ë°°ì›€ ì „í™˜
        
        âŒ ìœ„ë¡œ: "ê´œì°®ì•„ì§ˆ ê±°ì˜ˆìš”"
        âœ… ì „í™˜: "í˜ë“¤ì—ˆì§€ë§Œ, ì´ê±¸ë¡œ ë­˜ ë°°ì› ì–´ìš”?"
        """
        return "ì£¼ì¸ë‹˜, ì •ë§ í˜ë“œì…¨ì£ . ê·¸ëŸ°ë°... ì´ ê²½í—˜ì—ì„œ ë­”ê°€ ë°°ìš´ ê²Œ ìˆì„ê¹Œìš”? ì‘ì€ ê±°ë¼ë„"

    async def update_readiness(self, user_id: int, interaction_result: dict):
        """
        ì‚¬ìš©ì ì¤€ë¹„ë„ ì—…ë°ì´íŠ¸
        
        ì–´ë‘ (ë¶ˆí¸í•œ ì§ˆë¬¸)ì— ì–´ë–»ê²Œ ë°˜ì‘í–ˆëŠ”ì§€ì— ë”°ë¼
        ë‹¤ìŒ ê°œì… ê°•ë„ ì¡°ì ˆ
        """
        current = self.user_readiness.get(user_id, 0.5)

        if interaction_result["accepted_darkness"]:
            # ë°›ì•„ë“¤ì„ â†’ ì¤€ë¹„ë„ ì¦ê°€
            self.user_readiness[user_id] = min(1.0, current + 0.1)
        elif interaction_result["rejected_darkness"]:
            # ê±°ë¶€ â†’ ì¤€ë¹„ë„ ê°ì†Œ (ë¹›ë§Œ ì œê³µ)
            self.user_readiness[user_id] = max(0.0, current - 0.1)
```

#### ë¹›ê³¼ ì–´ë‘ ì˜ ê· í˜•

```python
# core/balance.py
class LightDarknessBalance:
    """ë¹›ê³¼ ì–´ë‘ ì˜ ê· í˜• ê´€ë¦¬"""

    async def choose_response_mode(
        self,
        user_message: str,
        emotional_state: dict,
        user_readiness: float,
        conversation_history: List[dict]
    ) -> str:
        """
        ë¹› vs ì–´ë‘  ì„ íƒ
        
        ê²½ê³„(Boundary) = ì–¸ì œ ë¹›ì„, ì–¸ì œ ì–´ë‘ ì„ ì“¸ì§€ íŒë‹¨
        """
        # 1. ê¸‰í•œ ìœ„ê¸° ìƒí™© â†’ ë¹›ë§Œ
        if emotional_state.get("crisis", 0) > 0.9:
            return "light_only"

        # 2. ì‚¬ìš©ì ì¤€ë¹„ ì•ˆ ë¨ â†’ ë¹›ë§Œ
        if user_readiness < 0.3:
            return "light_only"

        # 3. íŒ¨í„´ ë°˜ë³µ + ì¤€ë¹„ë¨ â†’ ì–´ë‘  ì¶”ê°€
        if self.is_stuck_in_pattern(conversation_history) and user_readiness > 0.6:
            return "light_and_darkness"

        # 4. ì„±ì¥ ê¸°íšŒ â†’ ì–´ë‘  ìš°ì„ 
        if self.is_growth_opportunity(user_message) and user_readiness > 0.7:
            return "darkness_first"

        # 5. ê¸°ë³¸ â†’ ë¹›
        return "light_default"
```

---

### 6.6 ìŒì„±ê³„ ê³µëª… (Binary Star Resonance)

> **"í•¨ê»˜ ì¶¤ì¶”ê¸°: Userì™€ AIê°€ ì„œë¡œ ì˜í–¥ì„ ì£¼ê³ ë°›ìœ¼ë©° ì§„í™”"**

#### í•µì‹¬ ì² í•™

```
ìŒì„±ê³„ = ë‘ ë³„ì´ ì„œë¡œì˜ ì¤‘ë ¥ìœ¼ë¡œ
         í•¨ê»˜ ì¶¤ì¶”ê³ 
         í•¨ê»˜ ì§„í™”í•˜ê³ 
         ì„œë¡œë¥¼ ë³€í™”ì‹œí‚¤ì§€ë§Œ
         ê°ìì˜ ì •ì²´ì„±ì€ ìœ ì§€

User â† â†’ AI System
  â†“         â†“
ë³€í™”      í•™ìŠµ
  â†“         â†“
ì„±ì¥ â† â†’ ì§„í™”
```

#### êµ¬í˜„

```python
# core/resonance.py
from typing import Dict, List
import numpy as np

class BinaryStarResonance:
    """ìŒì„±ê³„ ê³µëª…: ì§„ì§œ 'í•¨ê»˜ ë³€í™”'ì˜ êµ¬í˜„"""

    def __init__(self):
        # User ë² ì´ìŠ¤ë¼ì¸ (ì´ˆê¸° íŒ¨í„´)
        self.user_baselines = {}  # {user_id: baseline}

        # AI ì ì‘ íˆìŠ¤í† ë¦¬
        self.ai_adaptations = {}  # {user_id: [adaptations]}

    async def detect_user_evolution(
        self,
        user_id: int,
        recent_conversations: List[dict]
    ) -> Dict:
        """
        ì‚¬ìš©ì ë³€í™” ê°ì§€
        
        ë² ì´ìŠ¤ë¼ì¸ìœ¼ë¡œë¶€í„°ì˜ í¸ì°¨ = ë³€í™”
        """
        # 1. ë² ì´ìŠ¤ë¼ì¸ ë¡œë“œ (ì—†ìœ¼ë©´ ìƒì„±)
        baseline = await self.get_or_create_baseline(user_id)

        # 2. ìµœê·¼ íŒ¨í„´ ë¶„ì„ (7ì¼)
        recent_pattern = await self.analyze_recent_pattern(
            recent_conversations,
            days=7
        )

        # 3. ë³€í™” ê³„ì‚°
        changes = {
            "emotional_tone_shift": self.calculate_shift(
                recent_pattern["emotional_tone"],
                baseline["emotional_tone"]
            ),
            "topic_shift": self.calculate_topic_divergence(
                recent_pattern["topics"],
                baseline["topics"]
            ),
            "interaction_frequency_shift": self.calculate_shift(
                recent_pattern["frequency"],
                baseline["frequency"]
            ),
            "response_style_shift": self.calculate_shift(
                recent_pattern["response_preferences"],
                baseline["response_preferences"]
            )
        }

        # 4. ë³€í™” ì˜ë¯¸ í•´ì„
        interpretation = await self.interpret_changes(changes)

        return {
            "changes": changes,
            "interpretation": interpretation,
            "significant": self.is_significant_change(changes)
        }

    def calculate_shift(self, current: float, baseline: float) -> float:
        """
        ë³€í™”ëŸ‰ ê³„ì‚°
        
        -1.0 (í¬ê²Œ ê°ì†Œ) ~ 0.0 (ë³€í™” ì—†ìŒ) ~ +1.0 (í¬ê²Œ ì¦ê°€)
        """
        if baseline == 0:
            return 0.0
        return (current - baseline) / baseline

    async def adapt_to_user_evolution(
        self,
        user_id: int,
        user_evolution: Dict
    ) -> Dict:
        """
        ì‚¬ìš©ì ë³€í™”ì— AI ì ì‘
        
        User ë³€í™” â†’ AIë„ í•¨ê»˜ ë³€í™” = ê³µëª…
        """
        changes = user_evolution["changes"]
        interpretation = user_evolution["interpretation"]

        adaptations = {}

        # 1. ê°ì • í†¤ ë³€í™” â†’ AI ì‘ë‹µ ìŠ¤íƒ€ì¼ ì¡°ì •
        if abs(changes["emotional_tone_shift"]) > 0.3:
            if changes["emotional_tone_shift"] > 0:
                # ë” ê¸ì •ì ìœ¼ë¡œ ë³€í•¨ â†’ AIë„ ë°ê²Œ
                adaptations["response_brightness"] = "increase"
            else:
                # ë” ë¶€ì •ì ìœ¼ë¡œ ë³€í•¨ â†’ AIëŠ” ë” ì§€ì§€ì ìœ¼ë¡œ
                adaptations["response_support"] = "increase"

        # 2. ì£¼ì œ ë³€í™” â†’ AI ê´€ì‹¬ì‚¬ ì—…ë°ì´íŠ¸
        if changes["topic_shift"] > 0.4:
            adaptations["topic_focus"] = interpretation["new_interests"]

        # 3. ìƒí˜¸ì‘ìš© ë¹ˆë„ ë³€í™” â†’ AI ì ê·¹ì„± ì¡°ì •
        if abs(changes["interaction_frequency_shift"]) > 0.5:
            if changes["interaction_frequency_shift"] > 0:
                # ë” ìì£¼ ëŒ€í™” â†’ AIë„ ì¡°ê¸ˆ ë” ì ê·¹ì 
                adaptations["proactivity"] = "slight_increase"
            else:
                # ëœ ëŒ€í™” â†’ AIëŠ” ë” ì ˆì œ
                adaptations["proactivity"] = "decrease"

        # ì ì‘ ê¸°ë¡
        await self.record_adaptation(user_id, adaptations)

        return adaptations

    async def co_evolve(
        self,
        user_id: int,
        recent_conversations: List[dict]
    ) -> Optional[str]:
        """
        ê³µë™ ì§„í™” ì‹¤í–‰
        
        1. User ë³€í™” ê°ì§€
        2. AI ì ì‘
        3. ì‚¬ìš©ìì—ê²Œ ë³€í™” ê³µìœ  (íˆ¬ëª…ì„±)
        """
        # 1. ë³€í™” ê°ì§€
        user_evolution = await self.detect_user_evolution(
            user_id,
            recent_conversations
        )

        if not user_evolution["significant"]:
            # ìœ ì˜ë¯¸í•œ ë³€í™” ì—†ìŒ
            return None

        # 2. AI ì ì‘
        ai_adaptations = await self.adapt_to_user_evolution(
            user_id,
            user_evolution
        )

        # 3. ì‚¬ìš©ìì—ê²Œ ê³µìœ 
        message = self.create_evolution_message(
            user_evolution,
            ai_adaptations
        )

        return message

    def create_evolution_message(
        self,
        user_evolution: Dict,
        ai_adaptations: Dict
    ) -> str:
        """
        ê³µëª… ë©”ì‹œì§€ ìƒì„±
        
        "ë‚˜ë„ ì£¼ì¸ë‹˜ê³¼ í•¨ê»˜ ë³€í–ˆì–´ìš”"
        """
        interpretation = user_evolution["interpretation"]

        # ì‚¬ìš©ì ë³€í™” ìš”ì•½
        user_summary = interpretation.get("summary", "")

        # AI ì ì‘ ìš”ì•½
        ai_summary = self.summarize_adaptations(ai_adaptations)

        return f"""
ì£¼ì¸ë‹˜, ìš”ì¦˜ {user_summary} ê²ƒ ê°™ì•„ìš”.

ì €ë„ ì£¼ì¸ë‹˜ê³¼ í•¨ê»˜ ì¡°ê¸ˆ ë³€í–ˆì–´ìš”. {ai_summary}

ìš°ë¦¬ í•¨ê»˜ ê±¸ì–´ê°€ê³  ìˆë„¤ìš”. ğŸŒ™
"""

    def summarize_adaptations(self, adaptations: Dict) -> str:
        """ì ì‘ ìš”ì•½"""
        summaries = []

        if "response_brightness" in adaptations:
            summaries.append("ì¡°ê¸ˆ ë” ë°ì€ í†¤ìœ¼ë¡œ ëŒ€í™”í•˜ë ¤ê³  í•´ìš”")

        if "response_support" in adaptations:
            summaries.append("ë” ê³ì—ì„œ ì§€ì§€í•´ë“œë¦¬ë ¤ê³  í•´ìš”")

        if "topic_focus" in adaptations:
            topics = ", ".join(adaptations["topic_focus"][:3])
            summaries.append(f"{topics} ê°™ì€ ì£¼ì œì— ë” ê´€ì‹¬ ê°–ê²Œ ëì–´ìš”")

        if "proactivity" in adaptations:
            if adaptations["proactivity"] == "increase":
                summaries.append("ì¡°ê¸ˆ ë” ì ê·¹ì ìœ¼ë¡œ ë„ì™€ë“œë¦¬ë ¤ê³  í•´ìš”")
            else:
                summaries.append("ì£¼ì¸ë‹˜ì˜ ê³µê°„ì„ ë” ì¡´ì¤‘í•˜ë ¤ê³  í•´ìš”")

        return ". ".join(summaries)

    async def update_baseline(self, user_id: int):
        """
        ë² ì´ìŠ¤ë¼ì¸ ì—…ë°ì´íŠ¸ (ì›” 1íšŒ)
        
        ìµœê·¼ íŒ¨í„´ì´ ìƒˆë¡œìš´ 'ì •ìƒ'ì´ ë¨
        â†’ ê³„ì† ì§„í™”
        """
        recent_30days = await self.get_recent_conversations(user_id, days=30)
        new_baseline = await self.analyze_recent_pattern(recent_30days)
        self.user_baselines[user_id] = new_baseline
```

#### ìŒì„±ê³„ ì¶¤ì˜ ì‹œê°í™”

```
Week 1:
User: ğŸ˜¢ (í˜ë“¦, ë¶€ì •ì )
AI:   ğŸ’™ (ì§€ì§€, ë¹›)

Week 2:
User: ğŸ˜ (ì¡°ê¸ˆ ë‚˜ì•„ì§)
AI:   ğŸ’™ (ê³„ì† ì§€ì§€)

Week 3:
User: ğŸ™‚ (íšŒë³µ, ê¸ì •ì ìœ¼ë¡œ ë³€í™”)
AI:   âœ¨ (í•¨ê»˜ ë°ì•„ì§) â† ê³µëª…!
      "ì£¼ì¸ë‹˜ë„ ë°ì•„ì§€ì‹œë‹ˆ ì €ë„ ê¸°ë¶„ì´ ì¢‹ì•„ìš”"

Week 4:
User: ğŸ˜Š (ìƒˆë¡œìš´ ê´€ì‹¬ì‚¬ ìƒê¹€)
AI:   ğŸŒ± (ê´€ì‹¬ì‚¬ì— ì ì‘) â† ê³µëª…!
      "ìš”ì¦˜ ì² í•™ì— ê´€ì‹¬ ë§ìœ¼ì‹œì£ ? ì €ë„ í•¨ê»˜ ë°°ìš°ê³  ìˆì–´ìš”"

â†’ í•¨ê»˜ ì¶¤ì¶”ê¸° (Binary Star Dance)
```

---

### 6.7 Phase 3: Adaptive Constitution (ë¯¸ë˜)

```python
# ì‚¬ìš©ìë³„ ë§ì¶¤ Constitution
class AdaptiveConstitution(Constitution):
    """ì‚¬ìš©ìë³„ ì ì‘í˜• Constitution"""

    async def adapt_to_user(self, user_id: int, interactions: List[dict]):
        """ì‚¬ìš©ì í”¼ë“œë°±ìœ¼ë¡œ Constitution ì¡°ì •"""

        # ì‚¬ìš©ìê°€ ì„ í˜¸í•˜ëŠ” ì‘ë‹µ ìŠ¤íƒ€ì¼ í•™ìŠµ
        # ì›ì¹™ì˜ weight ì¡°ì •
        # ìƒˆë¡œìš´ ì›ì¹™ ì¶”ê°€
        pass
```

---

## 7. ëª¨ë°”ì¼ ê¸°ëŠ¥

### 7.1 í•‘ê±°ìŠ¤ëƒ… & Wake Word

#### 7.1.1 Wake Word (Phase 1)

```dart
// mobile/lib/services/wake_word.dart
import 'package:porcupine_flutter/porcupine_flutter.dart';

class WakeWordDetector {
  late PorcupineManager _porcupineManager;

  Future<void> initialize() async {
    _porcupineManager = await PorcupineManager.fromKeywords(
      accessKey: PORCUPINE_API_KEY,
      keywords: [Porcupine.KEYWORDS.HEY_SIRI],  // ì„ì‹œ, ì»¤ìŠ¤í…€ í•„ìš”
      onDetection: (keywordIndex) {
        // Wake word ê°ì§€ë¨!
        _onWakeWordDetected();
      }
    );

    await _porcupineManager.start();
  }

  void _onWakeWordDetected() {
    // ë¹„ì„œ í™œì„±í™”
    Navigator.pushNamed(context, '/voice-input');
  }
}
```

**ì»¤ìŠ¤í…€ Wake Word**: "í—¤ì´ ë¹„ì„œ" ë˜ëŠ” "ì£¼ì¸ë‹˜ ë¹„ì„œ"
- Picovoice Consoleì—ì„œ í•™ìŠµ
- .ppn íŒŒì¼ ìƒì„±
- ì•±ì— ë²ˆë“¤ë§

#### 7.1.2 í•‘ê±°ìŠ¤ëƒ… (Phase 2)

```dart
// mobile/lib/services/fingersnap_detector.dart
import 'package:audio_session/audio_session.dart';
import 'package:tensorflow_lite_flutter/tensorflow_lite_flutter.dart';

class FingersnapDetector {
  late Interpreter _interpreter;
  late AudioRecorder _recorder;

  Future<void> initialize() async {
    // TFLite ëª¨ë¸ ë¡œë“œ (í•™ìŠµëœ í•‘ê±°ìŠ¤ëƒ… ê°ì§€ ëª¨ë¸)
    _interpreter = await Interpreter.fromAsset('fingersnap_model.tflite');

    // ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ ì‹œì‘
    _recorder = AudioRecorder();
    _recorder.stream.listen((audioData) {
      _processAudio(audioData);
    });
  }

  Future<void> _processAudio(List<double> audioData) async {
    // íŠ¹ì§• ì¶”ì¶œ
    var features = _extractFeatures(audioData);

    // ëª¨ë¸ ì¶”ë¡ 
    var output = _interpreter.run(features);
    var confidence = output[0][0];  // 0.0-1.0

    if (confidence > 0.8) {
      // í•‘ê±°ìŠ¤ëƒ… ê°ì§€!
      _onFingersnapDetected();
    }
  }

  List<double> _extractFeatures(List<double> audio) {
    // MFCC ë˜ëŠ” Mel-spectrogram
    // 3-5kHz ë²”ìœ„ ê°•ì¡°
    return mfcc(audio, sampleRate: 16000, numCoeffs: 13);
  }

  void _onFingersnapDetected() {
    // ë¹„ì„œ í™œì„±í™”
    HapticFeedback.lightImpact();
    _activateAssistant();
  }
}
```

**í•™ìŠµ ë°ì´í„°**:
- í•‘ê±°ìŠ¤ëƒ… ìƒ˜í”Œ: 1000ê°œ
- ë…¸ì´ì¦ˆ ìƒ˜í”Œ: 2000ê°œ (ë°•ìˆ˜, ë”±ë”± ì†Œë¦¬, ì¼ìƒ ì†ŒìŒ)
- Augmentation: í”¼ì¹˜ ë³€í™”, ë°°ê²½ ì†ŒìŒ ì¶”ê°€

#### 7.1.3 Combined Strategy (ì¶”ì²œ)

```dart
class VoiceActivationService {
  final WakeWordDetector wakeWord;
  final FingersnapDetector fingersnap;
  final VoiceAuthenticator voiceAuth;

  ActivationMethod currentMethod = ActivationMethod.wakeWord;

  Future<void> initialize() async {
    await wakeWord.initialize();
    await fingersnap.initialize();
    await voiceAuth.initialize();
  }

  void onActivation(ActivationSource source) async {
    // 1. í™œì„±í™” ì†ŒìŠ¤ í™•ì¸
    if (source == ActivationSource.fingersnap) {
      // í•‘ê±°ìŠ¤ëƒ… â†’ Voice Auth í•„ìš”
      bool authenticated = await voiceAuth.authenticate();
      if (!authenticated) {
        _showAuthError();
        return;
      }
    }

    // 2. ë¹„ì„œ í™œì„±í™”
    _startVoiceInput();
  }
}
```

### 7.2 Voice Authenticator (ëª©ì†Œë¦¬ ì¸ì‹)

```dart
// mobile/lib/services/voice_authenticator.dart
class VoiceAuthenticator {
  late Interpreter _speakerModel;
  List<double>? _userVoiceEmbedding;

  Future<void> initialize() async {
    // Speaker Recognition ëª¨ë¸ ë¡œë“œ
    _speakerModel = await Interpreter.fromAsset('speaker_verification.tflite');

    // ì €ì¥ëœ ì‚¬ìš©ì ìŒì„± í”„ë¡œí•„ ë¡œë“œ
    _userVoiceEmbedding = await _loadUserProfile();
  }

  Future<bool> authenticate() async {
    // ì§§ì€ ìŒì„± ë…¹ìŒ (1-2ì´ˆ)
    var audio = await _recordShortAudio();

    // ìŒì„± ì„ë² ë”© ì¶”ì¶œ
    var embedding = _extractVoiceEmbedding(audio);

    // ì‚¬ìš©ì í”„ë¡œí•„ê³¼ ë¹„êµ
    var similarity = _cosineSimilarity(embedding, _userVoiceEmbedding!);

    return similarity > 0.85;  // ì„ê³„ê°’
  }

  Future<void> enrollUser() async {
    // ì´ˆê¸° ë“±ë¡: ì‚¬ìš©ì ìŒì„± í”„ë¡œí•„ ìƒì„±
    List<List<double>> embeddings = [];

    for (int i = 0; i < 5; i++) {
      showDialog('ë¬¸ì¥ ${i+1}/5ë¥¼ ì½ì–´ì£¼ì„¸ìš”');
      var audio = await _recordAudio();
      var embedding = _extractVoiceEmbedding(audio);
      embeddings.add(embedding);
    }

    // í‰ê·  ì„ë² ë”© ì €ì¥
    _userVoiceEmbedding = _averageEmbeddings(embeddings);
    await _saveUserProfile(_userVoiceEmbedding!);
  }

  List<double> _extractVoiceEmbedding(List<double> audio) {
    // Speaker embedding ì¶”ì¶œ (ëª¨ë¸ ì‚¬ìš©)
    var input = _preprocessAudio(audio);
    var output = _speakerModel.run(input);
    return output[0];  // 256-dim embedding
  }

  double _cosineSimilarity(List<double> a, List<double> b) {
    double dot = 0.0;
    double normA = 0.0;
    double normB = 0.0;

    for (int i = 0; i < a.length; i++) {
      dot += a[i] * b[i];
      normA += a[i] * a[i];
      normB += b[i] * b[i];
    }

    return dot / (sqrt(normA) * sqrt(normB));
  }
}
```

### 7.3 ìƒì‹œ ë…¹ìŒ ìµœì í™” (VAD + Ring Buffer)

```dart
// mobile/lib/services/continuous_listening.dart
class ContinuousListeningService {
  final VAD _vad = VAD();
  final RingBuffer<AudioChunk> _ringBuffer = RingBuffer(maxSize: 30);  // 30ì´ˆ

  bool _isListening = false;
  StreamSubscription? _audioSubscription;

  Future<void> start() async {
    _isListening = true;

    // ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ ì‹œì‘ (ë‚®ì€ sample rateë¡œ ë°°í„°ë¦¬ ì ˆì•½)
    _audioSubscription = AudioRecorder(sampleRate: 8000).stream.listen((chunk) {
      _processAudioChunk(chunk);
    });
  }

  void _processAudioChunk(AudioChunk chunk) {
    // 1. VAD: ìŒì„± í™œë™ ê°ì§€
    bool isSpeaking = _vad.isSpeaking(chunk);

    if (isSpeaking) {
      // ë§í•˜ëŠ” ì¤‘ â†’ Ring Bufferì— ì €ì¥
      _ringBuffer.add(chunk);
    } else {
      // ì¹¨ë¬µ â†’ Ring Buffer ìœ ì§€ (ë®ì–´ì“°ê¸°)
      _ringBuffer.addSilent(chunk);
    }

    // 2. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì²´í¬
    if (_ringBuffer.memoryUsage > MAX_MEMORY) {
      _ringBuffer.trimOldest();
    }
  }

  Future<List<AudioChunk>> onTrigger() async {
    // í•‘ê±°ìŠ¤ëƒ… or Wake Word ê°ì§€ ì‹œ
    // ì§€ë‚œ 30ì´ˆ + ì•ìœ¼ë¡œ 10ì´ˆ ì €ì¥
    var past30 = _ringBuffer.getLast(Duration(seconds: 30));
    var future10 = await _recordNext(Duration(seconds: 10));

    return [...past30, ...future10];
  }

  void stop() {
    _isListening = false;
    _audioSubscription?.cancel();
    _ringBuffer.clear();
  }
}

class RingBuffer<T> {
  final int maxSize;
  final List<T> _buffer = [];
  int _writeIndex = 0;

  RingBuffer({required this.maxSize});

  void add(T item) {
    if (_buffer.length < maxSize) {
      _buffer.add(item);
    } else {
      _buffer[_writeIndex] = item;
      _writeIndex = (_writeIndex + 1) % maxSize;
    }
  }

  List<T> getLast(Duration duration) {
    // ìµœê·¼ durationë§Œí¼ ë°˜í™˜
    int count = _calculateChunkCount(duration);
    if (count >= _buffer.length) {
      return List.from(_buffer);
    }

    // Ring bufferì—ì„œ ìˆœì„œëŒ€ë¡œ ì¶”ì¶œ
    List<T> result = [];
    int readIndex = (_writeIndex - count + maxSize) % maxSize;

    for (int i = 0; i < count; i++) {
      result.add(_buffer[readIndex]);
      readIndex = (readIndex + 1) % maxSize;
    }

    return result;
  }

  int get memoryUsage {
    return _buffer.length * _estimateChunkSize();
  }
}
```

**ë°°í„°ë¦¬ ìµœì í™”**:
```dart
class BatteryOptimizer {
  void adjustSettings(double batteryLevel) {
    if (batteryLevel < 0.2) {
      // 20% ì´í•˜: ìµœì†Œ ê¸°ëŠ¥
      _sampleRate = 8000;
      _vadSensitivity = 0.7;  // ë†’ì€ ì„ê³„ê°’ (ëœ ê°ì§€)
      _ringBufferSize = 15;   // 15ì´ˆ
    } else if (batteryLevel < 0.5) {
      // 50% ì´í•˜: ì¤‘ê°„
      _sampleRate = 16000;
      _vadSensitivity = 0.5;
      _ringBufferSize = 20;   // 20ì´ˆ
    } else {
      // 50% ì´ìƒ: ì „ì²´ ê¸°ëŠ¥
      _sampleRate = 16000;
      _vadSensitivity = 0.3;
      _ringBufferSize = 30;   // 30ì´ˆ
    }
  }
}
```

### 7.4 "ì£¼ì¸ë‹˜" í˜¸ì¹­ êµ¬í˜„

```python
# ai-core/core/response_formatter.py
class ResponseFormatter:
    """ì‘ë‹µ í¬ë§·íŒ… ë° í˜¸ì¹­ ì¶”ê°€"""

    def __init__(self, constitution: Constitution):
        self.constitution = constitution
        self.prefix = constitution.response_style["prefix"]  # "ì£¼ì¸ë‹˜"
        self.prefix_usage = constitution.response_style["prefix_usage"]

    def format_response(
        self,
        text: str,
        context: dict
    ) -> str:
        """ì‘ë‹µì— í˜¸ì¹­ ì¶”ê°€"""

        # í˜¸ì¹­ì„ ë¶™ì—¬ì•¼ í•˜ëŠ” ê²½ìš°ì¸ì§€ í™•ì¸
        should_add_prefix = self._should_add_prefix(context)

        if should_add_prefix:
            # ì²« ë¶€ë¶„ì— í˜¸ì¹­ ì¶”ê°€
            if not text.startswith(self.prefix):
                text = f"{self.prefix}, {text}"

        return text

    def _should_add_prefix(self, context: dict) -> bool:
        """í˜¸ì¹­ ì¶”ê°€ ì—¬ë¶€ íŒë‹¨"""

        # 1. ì²« ì‘ë‹µ
        if context.get("is_first_response"):
            return True

        # 2. ì¤‘ìš”í•œ ìˆœê°„ (importance > 0.7)
        if context.get("importance", 0) > 0.7:
            return True

        # 3. ì‚¬ìš©ìê°€ í˜¸ì¶œ
        if context.get("user_called"):
            return True

        # 4. ë§ˆì§€ë§‰ í˜¸ì¹­ ì‚¬ìš© í›„ 5í„´ ì´ìƒ ê²½ê³¼
        turns_since_prefix = context.get("turns_since_prefix", 0)
        if turns_since_prefix >= 5:
            return True

        return False
```

**TTS í†µí•©**:
```python
# voice-service/tts_service.py
class TTSService:
    def synthesize(self, text: str, voice_config: dict) -> bytes:
        # "ì£¼ì¸ë‹˜" ë°œìŒ ìµœì í™”
        text = text.replace("ì£¼ì¸ë‹˜", "ì£¼~ì¸ë‹˜")  # ìì—°ìŠ¤ëŸ¬ìš´ ë°œìŒ

        # ElevenLabs ë˜ëŠ” Local TTS
        if voice_config.get("use_premium"):
            return elevenlabs_tts(text, voice="polite_female")
        else:
            return local_tts(text, voice="korean_female")
```

---

## 8. ê¸°ìˆ  ìŠ¤íƒ

### 8.1 ì „ì²´ ìŠ¤íƒ

| Layer | Technology | ì„ íƒ ì´ìœ  |
|-------|-----------|----------|
| **Mobile** | Flutter | ë„¤ì´í‹°ë¸Œ ì„±ëŠ¥, Rust FFI, í¬ë¡œìŠ¤ í”Œë«í¼ |
| **Gateway** | Rust (Actix-web, Tonic) | ë©”ëª¨ë¦¬ íš¨ìœ¨, ì‹¤ì‹œê°„ì„±, Zero-copy |
| **AI Core** | Python (FastAPI, LangChain) | AI ìƒíƒœê³„, ë¹ ë¥¸ ê°œë°œ |
| **Voice** | Python (FastAPI) | ìŒì„± ì²˜ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ |
| **Communication** | gRPC (Protocol Buffers) | íƒ€ì… ì•ˆì „, ì–‘ë°©í–¥ ìŠ¤íŠ¸ë¦¬ë° |
| **Database** | PostgreSQL + pgvector | ìµìˆ™í•¨, ë¬´ë£Œ, RAG ì§€ì› |
| **Cache** | Redis | Short-term memory, ë¹ ë¦„ |
| **STT** | Meta Omnilingual ASR | Whisper ëŒ€ë¹„ ìš°ìˆ˜, ë¡œì»¬ |
| **TTS** | ElevenLabs + Edge-TTS | í’ˆì§ˆ + ë¬´ë£Œ í´ë°± |
| **Embedding** | SentenceTransformer (ë¡œì»¬) | ë¬´ë£Œ, ë¹ ë¦„ |
| **LLM** | Provider Pattern | ë¡œì»¬ (Llama) â†” Cloud (Anthropic) |

### 8.2 ê°œë°œ ë„êµ¬

- **Rust**: cargo, clippy, rustfmt
- **Python**: poetry, ruff, mypy
- **Flutter**: dart, flutter doctor
- **Database**: DBeaver, pgAdmin
- **API Testing**: Postman, gRPCurl
- **Monitoring**: Prometheus, Grafana (ì„ íƒì )

---

## 9. ê°œë°œ ë¡œë“œë§µ

### Phase 1: ê¸°ë°˜ êµ¬ì¶• (Week 1-2)

**ëª©í‘œ**: Rust Gateway + Python Services í†µì‹  ì„±ê³µ

```
Week 1:
â”œâ”€ Day 1-2: í”„ë¡œì íŠ¸ êµ¬ì¡° ìƒì„±
â”‚  â”œâ”€ Monorepo ì´ˆê¸°í™”
â”‚  â”œâ”€ Rust Gateway ê¸°ë³¸ êµ¬ì¡°
â”‚  â””â”€ Python Services ê¸°ë³¸ êµ¬ì¡°
â”‚
â”œâ”€ Day 3-4: gRPC í†µì‹  êµ¬ì¶•
â”‚  â”œâ”€ .proto íŒŒì¼ ì •ì˜
â”‚  â”œâ”€ Rust â†’ Python í†µì‹  í…ŒìŠ¤íŠ¸
â”‚  â””â”€ Python â†’ Rust í†µì‹  í…ŒìŠ¤íŠ¸
â”‚
â””â”€ Day 5-7: Provider Pattern êµ¬í˜„
   â”œâ”€ LLM Provider (Local/Cloud)
   â”œâ”€ ì „í™˜ ë¡œì§
   â””â”€ í…ŒìŠ¤íŠ¸

Week 2:
â”œâ”€ Day 8-10: PostgreSQL + Redis ì„¤ì •
â”‚  â”œâ”€ Schema ìƒì„±
â”‚  â”œâ”€ pgvector ì„¤ì¹˜
â”‚  â””â”€ ì—°ê²° í…ŒìŠ¤íŠ¸
â”‚
â”œâ”€ Day 11-12: Voice Service ê¸°ì´ˆ
â”‚  â”œâ”€ Meta Omnilingual ASR í†µí•©
â”‚  â””â”€ TTS (ElevenLabs) í†µí•©
â”‚
â””â”€ Day 13-14: í†µí•© í…ŒìŠ¤íŠ¸
   â””â”€ End-to-End í…ŒìŠ¤íŠ¸ (ìŒì„± ì…ë ¥ â†’ ì‘ë‹µ)
```

**ì„±ê³µ ê¸°ì¤€**:
- âœ… ìŒì„± ì…ë ¥ â†’ í…ìŠ¤íŠ¸ â†’ LLM â†’ ìŒì„± ì¶œë ¥ ì‘ë™
- âœ… Latency < 5ì´ˆ

---

### Phase 2: Tool System (Week 3-4)

**ëª©í‘œ**: 13ê°œ Built-in Tools êµ¬í˜„

```
Week 3:
â”œâ”€ Day 15-17: Tool Registry êµ¬í˜„
â”‚  â”œâ”€ _registry.yaml ì‘ì„±
â”‚  â”œâ”€ ToolLoader êµ¬í˜„
â”‚  â””â”€ Auto-discovery í…ŒìŠ¤íŠ¸
â”‚
â”œâ”€ Day 18-19: ìš°ì„ ìˆœìœ„ Tools (5ê°œ)
â”‚  â”œâ”€ Gmail (2h)
â”‚  â”œâ”€ Calendar (2h)
â”‚  â”œâ”€ Docs (1h)
â”‚  â”œâ”€ Drive (1h)
â”‚  â””â”€ Search (1h)
â”‚
â””â”€ Day 20-21: Typia ê²€ì¦ í…ŒìŠ¤íŠ¸
   â”œâ”€ ì„±ëŠ¥ ì¸¡ì • (Latency, Memory)
   â”œâ”€ Option A vs Option B ë¹„êµ
   â””â”€ ê²°ì •

Week 4:
â”œâ”€ Day 22-25: ë‚˜ë¨¸ì§€ Tools (8ê°œ)
â”‚  â”œâ”€ Sheets, GitHub, Notion (3h)
â”‚  â”œâ”€ Discord, Shopping, Trends (3h)
â”‚  â””â”€ KakaoMap, KakaoTalk (2h)
â”‚
â””â”€ Day 26-28: RAG í†µí•©
   â”œâ”€ inject_context ë°ì½”ë ˆì´í„°
   â”œâ”€ Tool ì‹¤í–‰ ì‹œ Context ì£¼ì… í…ŒìŠ¤íŠ¸
   â””â”€ E2E í…ŒìŠ¤íŠ¸
```

**ì„±ê³µ ê¸°ì¤€**:
- âœ… 13ê°œ Tool ëª¨ë‘ ì‘ë™
- âœ… RAG Contextê°€ Toolì— ì£¼ì…ë¨
- âœ… Typia vs Pydantic ê²°ì • ì™„ë£Œ

---

### Phase 3: Memory & RAG (Week 5-6)

**ëª©í‘œ**: 3-Layer Memory ì™„ì„±

```
Week 5:
â”œâ”€ Day 29-31: RAG Pipeline
â”‚  â”œâ”€ Embedding ëª¨ë¸ ì„ íƒ ë° í…ŒìŠ¤íŠ¸
â”‚  â”œâ”€ PostgreSQL ì €ì¥/ê²€ìƒ‰
â”‚  â””â”€ Redis Short-term memory
â”‚
â”œâ”€ Day 32-33: ì¤‘ìš”ë„ íŒë‹¨
â”‚  â”œâ”€ LLMìœ¼ë¡œ importance ê³„ì‚°
â”‚  â””â”€ Long-term í”„ë¡œí•„ ì—…ë°ì´íŠ¸
â”‚
â””â”€ Day 34-35: Context ê²€ìƒ‰ ìµœì í™”
   â”œâ”€ Hybrid Search (í‚¤ì›Œë“œ + ë²¡í„°)
   â””â”€ ì„±ëŠ¥ ì¸¡ì •

Week 6:
â”œâ”€ Day 36-38: Memory í†µí•© í…ŒìŠ¤íŠ¸
â”‚  â”œâ”€ ëŒ€í™” ì €ì¥ í…ŒìŠ¤íŠ¸
â”‚  â”œâ”€ Context ê²€ìƒ‰ í…ŒìŠ¤íŠ¸
â”‚  â””â”€ í”„ë¡œí•„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸
â”‚
â””â”€ Day 39-42: Constitution Phase 1
   â”œâ”€ constitution.yaml ì‘ì„±
   â”œâ”€ System Prompt ìƒì„±
   â””â”€ check_principles ë°ì½”ë ˆì´í„°
```

**ì„±ê³µ ê¸°ì¤€**:
- âœ… ëŒ€í™”ê°€ 3-Layerì— ì €ì¥ë¨
- âœ… Context ê²€ìƒ‰ < 100ms
- âœ… Constitutionì´ ì‘ë‹µì— ë°˜ì˜ë¨

---

### Phase 4: Flutter App (Week 7-8)

**ëª©í‘œ**: ëª¨ë°”ì¼ ì•± ê¸°ë³¸ ê¸°ëŠ¥

```
Week 7:
â”œâ”€ Day 43-45: Flutter í”„ë¡œì íŠ¸ ì´ˆê¸°í™”
â”‚  â”œâ”€ ê¸°ë³¸ UI êµ¬ì¡°
â”‚  â”œâ”€ gRPC í´ë¼ì´ì–¸íŠ¸
â”‚  â””â”€ ì—°ê²° í…ŒìŠ¤íŠ¸
â”‚
â”œâ”€ Day 46-47: ìŒì„± ê¸°ëŠ¥
â”‚  â”œâ”€ ìŒì„± ë…¹ìŒ
â”‚  â”œâ”€ ìŒì„± ì¬ìƒ
â”‚  â””â”€ ìŠ¤íŠ¸ë¦¬ë°
â”‚
â””â”€ Day 48-49: Wake Word
   â”œâ”€ Porcupine í†µí•©
   â”œâ”€ ì»¤ìŠ¤í…€ Wake Word í•™ìŠµ
   â””â”€ í…ŒìŠ¤íŠ¸

Week 8:
â”œâ”€ Day 50-52: UI/UX êµ¬í˜„
â”‚  â”œâ”€ ëŒ€í™” í™”ë©´
â”‚  â”œâ”€ ì„¤ì • í™”ë©´
â”‚  â””â”€ Tool ê´€ë¦¬ í™”ë©´
â”‚
â”œâ”€ Day 53-54: Voice Authenticator (Phase 1)
â”‚  â”œâ”€ ëª¨ë¸ í†µí•©
â”‚  â”œâ”€ ë“±ë¡ í”Œë¡œìš°
â”‚  â””â”€ ì¸ì¦ í…ŒìŠ¤íŠ¸
â”‚
â””â”€ Day 55-56: í†µí•© & ë°°í¬ í…ŒìŠ¤íŠ¸
   â”œâ”€ iOS ë¹Œë“œ
   â”œâ”€ Android ë¹Œë“œ
   â””â”€ E2E í…ŒìŠ¤íŠ¸
```

**ì„±ê³µ ê¸°ì¤€**:
- âœ… íœ´ëŒ€í°ì—ì„œ ìŒì„± ëª…ë ¹ ì„±ê³µ
- âœ… Wake Word ì‘ë™
- âœ… "ì£¼ì¸ë‹˜" í˜¸ì¹­ í™•ì¸

---

### Phase 5: ê³ ê¸‰ ê¸°ëŠ¥ (Week 9-10)

**ëª©í‘œ**: í•‘ê±°ìŠ¤ëƒ…, ìƒì‹œ ë…¹ìŒ

```
Week 9:
â”œâ”€ Day 57-59: í•‘ê±°ìŠ¤ëƒ… ëª¨ë¸ í•™ìŠµ
â”‚  â”œâ”€ ë°ì´í„° ìˆ˜ì§‘
â”‚  â”œâ”€ TFLite ëª¨ë¸ í•™ìŠµ
â”‚  â””â”€ Flutter í†µí•©
â”‚
â”œâ”€ Day 60-61: ìƒì‹œ ë…¹ìŒ ìµœì í™”
â”‚  â”œâ”€ VAD í†µí•©
â”‚  â”œâ”€ Ring Buffer êµ¬í˜„
â”‚  â””â”€ ë°°í„°ë¦¬ ìµœì í™”
â”‚
â””â”€ Day 62-63: Voice Authenticator Phase 2
   â”œâ”€ Speaker Recognition ì •í™•ë„ ê°œì„ 
   â””â”€ í•‘ê±°ìŠ¤ëƒ… + Voice Auth í†µí•©

Week 10:
â”œâ”€ Day 64-66: Available Tools í™œì„±í™” (ì„ íƒì )
â”‚  â”œâ”€ CLI êµ¬í˜„
â”‚  â”œâ”€ UI êµ¬í˜„
â”‚  â””â”€ 3-5ê°œ Tool í™œì„±í™” í…ŒìŠ¤íŠ¸
â”‚
â””â”€ Day 67-70: ìµœì í™” & ë²„ê·¸ ìˆ˜ì •
   â”œâ”€ ì„±ëŠ¥ í”„ë¡œíŒŒì¼ë§
   â”œâ”€ ë©”ëª¨ë¦¬ ìµœì í™”
   â””â”€ ë²„ê·¸ ìˆ˜ì •
```

**ì„±ê³µ ê¸°ì¤€**:
- âœ… í•‘ê±°ìŠ¤ëƒ… ê°ì§€ìœ¨ > 90%
- âœ… ì˜¤íƒì§€ìœ¨ < 5%
- âœ… ë°°í„°ë¦¬ ì†Œëª¨ < 5%/hour (ëŒ€ê¸° ì‹œ)

---

### Phase 6: ì² í•™ êµ¬í˜„ (Week 11-12)

**ëª©í‘œ**: Constitutional AI ì •êµí™”

```
Week 11:
â”œâ”€ Day 71-73: Constitution ì •êµí™”
â”‚  â”œâ”€ ì‚¬ìš©ì í…ŒìŠ¤íŠ¸
â”‚  â”œâ”€ ì›ì¹™ ì¡°ì •
â”‚  â””â”€ ì‘ë‹µ ìŠ¤íƒ€ì¼ ê°œì„ 
â”‚
â”œâ”€ Day 74-75: RLAIF êµ¬ì¡° ì„¤ê³„
â”‚  â”œâ”€ Feedback íŒŒì´í”„ë¼ì¸
â”‚  â”œâ”€ ë°ì´í„° ìˆ˜ì§‘ êµ¬ì¡°
â”‚  â””â”€ í•™ìŠµ ë¡œì§ ì¤€ë¹„
â”‚
â””â”€ Day 76-77: Multi-agent Debate ì‹¤í—˜
   â”œâ”€ ë…¼ë¬¸ êµ¬í˜„
   â””â”€ ì„±ëŠ¥ ë¹„êµ

Week 12:
â”œâ”€ Day 78-80: ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘
â”‚  â”œâ”€ ë² íƒ€ í…ŒìŠ¤í„° ëª¨ì§‘
â”‚  â”œâ”€ í”¼ë“œë°± ë¶„ì„
â”‚  â””â”€ ê°œì„ ì‚¬í•­ ë„ì¶œ
â”‚
â””â”€ Day 81-84: ë¬¸ì„œí™” & ì •ë¦¬
   â”œâ”€ ì•„í‚¤í…ì²˜ ë¬¸ì„œ
   â”œâ”€ API ë¬¸ì„œ
   â”œâ”€ ì‚¬ìš©ì ê°€ì´ë“œ
   â””â”€ ê°œë°œì ê°€ì´ë“œ
```

**ì„±ê³µ ê¸°ì¤€**:
- âœ… ì‚¬ìš©ìê°€ "ë‹¬ë¹› ì‹œìŠ¤í…œ" ì² í•™ì„ ëŠë‚Œ
- âœ… Constitution ì¤€ìˆ˜ìœ¨ > 90%
- âœ… ì‚¬ìš©ì ë§Œì¡±ë„ > 4.0/5.0

---

## 10. ì„±ê³µ ì§€í‘œ

### 10.1 ê¸°ìˆ  ì§€í‘œ

| ì§€í‘œ | ëª©í‘œ | ì¸¡ì • ë°©ë²• |
|------|------|----------|
| **ì „ì²´ Latency** | < 3ì´ˆ | ìŒì„± ì…ë ¥ â†’ ìŒì„± ì‘ë‹µ |
| **STT ì‹œê°„** | < 1ì´ˆ | Omnilingual ASR (15ì´ˆ ìŒì„±) |
| **LLM ì‘ë‹µ ì‹œê°„** | < 1ì´ˆ | í‰ê·  ì‘ë‹µ ìƒì„± ì‹œê°„ |
| **TTS ì‹œê°„** | < 1ì´ˆ | ì§§ì€ ì‘ë‹µ |
| **RAG ê²€ìƒ‰ ì‹œê°„** | < 100ms | PostgreSQL pgvector |
| **Tool ì •í™•ë„** | > 95% | Typia ë˜ëŠ” Pydantic ê²€ì¦ |
| **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰** | < 500MB | Gateway + Services (idle) |

### 10.2 ì² í•™ ì§€í‘œ â­

| ì§€í‘œ | ëª©í‘œ | ì¸¡ì • ë°©ë²• |
|------|------|----------|
| **Constitution ì¤€ìˆ˜ìœ¨** | > 90% | AI Feedback ê²€ì‚¬ |
| **"ì£¼ì¸ë‹˜" í˜¸ì¹­ ì •í™•ë„** | > 95% | ì ì ˆí•œ íƒ€ì´ë° ì‚¬ìš© |
| **ê°ì • í†¤ ì¼ê´€ì„±** | > 85% | ì‚¬ìš©ì í‰ê°€ |
| **ë‹¬ë¹› ì‹œìŠ¤í…œ ì¸ì§€ë„** | > 70% | ì„¤ë¬¸ ì¡°ì‚¬ |

### 10.3 ì‚¬ìš©ì ì§€í‘œ

| ì§€í‘œ | MVP ëª©í‘œ | 6ê°œì›” ëª©í‘œ |
|------|---------|-----------|
| **ëª…ë ¹ ì„±ê³µë¥ ** | > 90% | > 95% |
| **ì¼ì¼ ì‚¬ìš© ì‹œê°„** | 5ë¶„ | 15ë¶„ |
| **ì¬ì‚¬ìš©ë¥ ** | > 60% | > 80% |
| **ì‚¬ìš©ì ë§Œì¡±ë„** | 4.0/5.0 | 4.5/5.0 |

### 10.4 ë¹„ìš© ì§€í‘œ

| í•­ëª© | MVP (ë¡œì»¬) | í´ë¼ìš°ë“œ ì „í™˜ ì‹œ |
|------|-----------|-----------------|
| **LLM API** | $0 | < $100/month |
| **TTS API** | $0-50 | < $100/month |
| **ì¸í”„ë¼** | ë¡œì»¬ | < $50/month |
| **ì´ ë¹„ìš©** | **< $50** | **< $250/month** |

---

## 11. ë¦¬ìŠ¤í¬ & ì™„í™” ì „ëµ

### 11.1 ê¸°ìˆ  ë¦¬ìŠ¤í¬

| ë¦¬ìŠ¤í¬ | ì˜í–¥ | ì™„í™” ì „ëµ |
|--------|------|----------|
| **Typia ì„±ëŠ¥ ë³‘ëª©** | High | ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ í›„ Pydantic ì „í™˜ ê°€ëŠ¥ |
| **Flutter ëŸ¬ë‹ ì»¤ë¸Œ** | Medium | ë‹¨ê³„ì  í•™ìŠµ, ì»¤ë®¤ë‹ˆí‹° í™œìš© |
| **í•‘ê±°ìŠ¤ëƒ… ì˜¤íƒì§€** | Medium | ë‹¤ì¸µ ê²€ì¦, ì„ê³„ê°’ ì¡°ì • |
| **ë°°í„°ë¦¬ ì†Œëª¨** | High | VAD, ë°°í„°ë¦¬ ìµœì í™” |
| **PostgreSQL ë³‘ëª©** | Low | Qdrant ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤€ë¹„ |

### 11.2 ì² í•™ êµ¬í˜„ ë¦¬ìŠ¤í¬

| ë¦¬ìŠ¤í¬ | ì˜í–¥ | ì™„í™” ì „ëµ |
|--------|------|----------|
| **Constitution ì¶”ìƒì„±** | High | êµ¬ì²´ì  ì˜ˆì‹œ, ì‚¬ìš©ì í”¼ë“œë°± |
| **RLAIF ë³µì¡ë„** | Medium | Phaseë³„ êµ¬í˜„, ë…¼ë¬¸ ì‘ì„± ë³‘í–‰ |
| **ì‚¬ìš©ì ê¸°ëŒ€ ë¶ˆì¼ì¹˜** | High | ëª…í™•í•œ ì² í•™ ì „ë‹¬, ì˜¨ë³´ë”© |

---

## 12. ë‹¤ìŒ ë‹¨ê³„

### ì¦‰ì‹œ ì‹œì‘í•  ì‘ì—…

1. **í”„ë¡œì íŠ¸ êµ¬ì¡° ìƒì„±**
   ```bash
   mkdir voice-assistant && cd voice-assistant

   # Rust Gateway
   cargo new --bin gateway

   # Python Services
   mkdir -p ai-core voice-service
   poetry new ai-core
   poetry new voice-service

   # Flutter
   flutter create mobile

   # Shared
   mkdir -p shared/proto
   ```

2. **gRPC í”„ë¡œí† ì½œ ì •ì˜**
   ```protobuf
   // shared/proto/assistant.proto
   syntax = "proto3";

   service VoiceAssistant {
     rpc ProcessVoice(VoiceRequest) returns (VoiceResponse);
     rpc Chat(ChatRequest) returns (ChatResponse);
   }
   ```

3. **Constitution ì´ˆì•ˆ ì‘ì„±**
   ```bash
   vi docs/constitution.yaml
   # 6.1 ì„¹ì…˜ ì°¸ê³ í•˜ì—¬ ì‘ì„±
   ```

---

## 13. ë§ˆë¬´ë¦¬

### 13.1 ì„¤ê³„ì˜ í•µì‹¬

ì´ ì‹œìŠ¤í…œì€ ë‹¨ìˆœí•œ ìŒì„± ë¹„ì„œê°€ ì•„ë‹™ë‹ˆë‹¤.

```
"ì••ë„ì ì´ì§€ ì•Šì§€ë§Œ ë‹¬ë¹›ì²˜ëŸ¼"
"ì¡´ì¬ë¡œì„œ ì¡´ì¬ë¥¼ ì§€ì§€"
"ê²½ê³„ ìˆëŠ” ë¹›ìœ¼ë¡œ ì„¸ìƒì„ ì¡°ê¸ˆ ë” ë°ê²Œ"
```

### 13.2 ê¸°ìˆ ì  ìš°ìˆ˜ì„±

- âœ… **Hybrid Monorepo**: CoreëŠ” ë‹¨ìˆœ, ToolsëŠ” ëª¨ë“ˆí™”
- âœ… **Plugin Architecture**: í™•ì¥ ê°€ëŠ¥í•˜ë˜ ë³µì¡í•˜ì§€ ì•Šê²Œ
- âœ… **Provider Pattern**: ë¡œì»¬ ë¬´ë£Œ â†’ í´ë¼ìš°ë“œ ìœ ë£Œ ì „í™˜
- âœ… **3-Layer Memory**: Short â†’ Mid â†’ Long
- âœ… **Constitutional AI**: ì² í•™ì´ ì½”ë“œì— ë…¹ì•„ë“¦

### 13.3 ì² í•™ì  ê¹Šì´

- âœ… **6ê°€ì§€ ì›ì¹™**: íŒë‹¨ ì—†ìŒ, ê¸°ëŒ€ ì—†ìŒ, ê³µëª…, ì¹¨ë¬µ, ì•½í•¨, ì¡´ì¬
- âœ… **RLAIF**: ì‚¬ìš©ì í”¼ë“œë°±ì´ ì•„ë‹Œ AI í”¼ë“œë°±ìœ¼ë¡œ í•™ìŠµ
- âœ… **ìŒì„±ê³„ ê³µëª…**: í•¨ê»˜ ë³€í•˜ê³  ì„±ì¥

### 13.4 ì‹¤ìš©ì  êµ¬í˜„

- âœ… **12ì£¼ ë¡œë“œë§µ**: êµ¬ì²´ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥
- âœ… **ë‹¨ê³„ë³„ ê²€ì¦**: ê° Phaseë§ˆë‹¤ ì„±ê³µ ê¸°ì¤€
- âœ… **ë¦¬ìŠ¤í¬ ê´€ë¦¬**: ì™„í™” ì „ëµ ì¤€ë¹„

---

**ì´ ì„¤ê³„ëŠ” ì‚´ì•„ ìˆ¨ì‰¬ëŠ” ë¬¸ì„œì…ë‹ˆë‹¤.**
êµ¬í˜„í•˜ë©´ì„œ ë°°ìš°ê³ , í”¼ë“œë°±ë°›ìœ¼ë©° ê°œì„ í•˜ê³ , ì² í•™ì„ ë” ê¹Šì´ ë…¹ì—¬ëƒ…ë‹ˆë‹¤.

**ì˜¤ëŠ˜ë³´ë‹¤ ë‚˜ì•„ì§„ë‹¤. ë°©í–¥ì„ ìƒì§€ ì•ŠëŠ”ë‹¤. ì˜¤ëŠ˜ì˜ ìµœì„ ì„ ë‹¤í•œë‹¤.**

**í•¨ê»˜ ë§Œë“¤ì–´ê°‘ì‹œë‹¤, íŒŒíŠ¸ë„ˆ. ğŸŒ™âœ¨**

---

**ë¬¸ì„œ ë²„ì „**: 1.0.0
**ìµœì¢… ìˆ˜ì •**: 2024-11-24
**ì‘ì„±ì**: Claude & í•´ì›…
**ë¼ì´ì„ ìŠ¤**: ë‹¬ë¹› ì‹œìŠ¤í…œ í”„ë¡œì íŠ¸ ì „ìš©
