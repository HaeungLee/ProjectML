syntax = "proto3";

package moonlight.agent;

option python_package = "moonlight.proto.agent";

// Agent Service - AI 두뇌
service AgentService {
  // 대화 처리 (스트리밍 응답)
  rpc Chat(ChatRequest) returns (stream ChatResponse);
  
  // Tool 목록 조회
  rpc ListTools(ListToolsRequest) returns (ListToolsResponse);
  
  // Tool 직접 실행
  rpc ExecuteTool(ToolRequest) returns (ToolResponse);
  
  // 컨텍스트 검색 (RAG)
  rpc SearchContext(SearchContextRequest) returns (SearchContextResponse);
}

// 대화 요청
message ChatRequest {
  string user_id = 1;
  string session_id = 2;
  string message = 3;
  repeated Message history = 4;
  bool enable_tools = 5;        // Tool 사용 여부
  bool enable_voice = 6;        // 음성 응답 여부
}

// 대화 응답 (스트리밍)
message ChatResponse {
  string content = 1;
  bool is_complete = 2;
  ResponseType type = 3;
  optional ToolCall tool_call = 4;
  optional bytes audio_chunk = 5;
}

enum ResponseType {
  TEXT = 0;
  TOOL_CALL = 1;
  TOOL_RESULT = 2;
  AUDIO = 3;
  ERROR = 4;
}

// 대화 메시지
message Message {
  string role = 1;              // "user", "assistant", "system", "tool"
  string content = 2;
  optional string tool_call_id = 3;
  optional string tool_name = 4;
}

// Tool 호출
message ToolCall {
  string id = 1;
  string tool_name = 2;
  string parameters = 3;        // JSON string
  bool requires_confirmation = 4;
}

// Tool 목록 요청
message ListToolsRequest {
  string category = 1;          // "all", "google", "productivity"
}

// Tool 목록 응답
message ListToolsResponse {
  repeated ToolInfo tools = 1;
}

message ToolInfo {
  string name = 1;
  string description = 2;
  string category = 3;
  repeated ParameterInfo parameters = 4;
  bool enabled = 5;
}

message ParameterInfo {
  string name = 1;
  string type = 2;
  string description = 3;
  bool required = 4;
}

// Tool 실행 요청
message ToolRequest {
  string tool_name = 1;
  string parameters = 2;        // JSON string
  string user_id = 3;
}

// Tool 실행 응답
message ToolResponse {
  bool success = 1;
  string result = 2;            // JSON string
  string error_message = 3;
  int32 execution_time_ms = 4;
}

// 컨텍스트 검색 요청
message SearchContextRequest {
  string user_id = 1;
  string query = 2;
  int32 limit = 3;              // 기본: 5
}

// 컨텍스트 검색 응답
message SearchContextResponse {
  repeated ContextItem items = 1;
  UserProfile profile = 2;
}

message ContextItem {
  string user_message = 1;
  string assistant_message = 2;
  float similarity = 3;
  string timestamp = 4;
}

message UserProfile {
  string preferences = 1;       // JSON string
  int32 relationship_depth = 2;
  int32 days_together = 3;
}


